<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>トライアスロン大会一覧 2025</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
            color: white;
            text-align: center;
            padding: 40px 20px;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
        }

        .filters {
            padding: 30px;
            background: #f8f9fa;
            border-bottom: 1px solid #e9ecef;
        }

        .filter-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
        }

        .filter-group label {
            font-weight: 600;
            margin-bottom: 8px;
            color: #333;
            font-size: 0.9rem;
        }

        .filter-group select, .filter-group input {
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .filter-group select:focus, .filter-group input:focus {
            outline: none;
            border-color: #4CAF50;
            box-shadow: 0 0 0 3px rgba(76, 175, 80, 0.1);
        }

        .stats {
            text-align: center;
            padding: 20px 30px;
            background: #e8f5e8;
            border-bottom: 1px solid #d4edda;
        }

        .stats h3 {
            color: #2e7d32;
            font-size: 1.3rem;
        }

        .race-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 25px;
            padding: 30px;
        }

        .race-card {
            background: white;
            border-radius: 15px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            overflow: hidden;
            border: 2px solid transparent;
        }

        .race-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(0,0,0,0.2);
            border-color: #4CAF50;
        }

        .race-card-header {
            background: linear-gradient(135deg, #2196F3 0%, #1976D2 100%);
            color: white;
            padding: 20px;
            text-align: center;
        }

        .race-card-header h3 {
            font-size: 1.3rem;
            margin-bottom: 5px;
        }

        .race-card-body {
            padding: 20px;
        }

        .race-info {
            display: grid;
            gap: 12px;
        }

        .race-info-item {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .race-info-item .icon {
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #f0f0f0;
            border-radius: 50%;
            font-size: 0.8rem;
        }

        .race-info-item .text {
            flex: 1;
            font-size: 0.95rem;
        }

        .distance-badge {
            background: linear-gradient(135deg, #FF9800 0%, #F57C00 100%);
            color: white;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            display: inline-block;
            margin-top: 10px;
        }

        .distance-badge.olympic {
            background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
        }

        .distance-badge.sprint {
            background: linear-gradient(135deg, #2196F3 0%, #1976D2 100%);
        }

        .distance-badge.long {
            background: linear-gradient(135deg, #9C27B0 0%, #7B1FA2 100%);
        }

        .no-results {
            text-align: center;
            padding: 60px 20px;
            color: #666;
        }

        .no-results h3 {
            font-size: 1.5rem;
            margin-bottom: 10px;
        }

        .debug-info {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            padding: 15px;
            margin: 20px 30px;
            border-radius: 8px;
            font-family: monospace;
            font-size: 0.9rem;
        }

        @media (max-width: 768px) {
            .container {
                margin: 10px;
                border-radius: 15px;
            }

            .header h1 {
                font-size: 2rem;
            }

            .filter-row {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            .race-grid {
                grid-template-columns: 1fr;
                padding: 20px;
                gap: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🏊‍♂️🚴‍♂️🏃‍♂️ トライアスロン大会一覧 2025</h1>
            <p>全国のトライアスロン大会情報をチェック！</p>
        </div>

        <div class="filters">
            <div class="filter-row">
                <div class="filter-group">
                    <label for="region-select">🗾 地域</label>
                    <select id="region-select">
                        <option value="">すべての地域</option>
                        <option value="北海道">北海道</option>
                        <option value="東北">東北</option>
                        <option value="関東">関東</option>
                        <option value="中部">中部</option>
                        <option value="関西">関西</option>
                        <option value="中国">中国</option>
                        <option value="四国">四国</option>
                        <option value="九州">九州</option>
                        <option value="沖縄">沖縄</option>
                    </select>
                </div>

                <div class="filter-group">
                    <label for="month-select">📅 開催月</label>
                    <select id="month-select">
                        <option value="">すべての月</option>
                        <option value="4">4月</option>
                        <option value="5">5月</option>
                        <option value="6">6月</option>
                        <option value="7">7月</option>
                        <option value="8">8月</option>
                        <option value="9">9月</option>
                        <option value="10">10月</option>
                        <option value="11">11月</option>
                    </select>
                </div>

                <div class="filter-group">
                    <label for="distance-select">🏆 競技距離</label>
                    <select id="distance-select">
                        <option value="">すべての距離</option>
                        <option value="スプリント">🏆 スプリント</option>
                        <option value="オリンピック">🏆 オリンピック</option>
                        <option value="ミドル">🏆 ミドル</option>
                        <option value="ロング">🏆 ロング</option>
                        <option value="アイアンマン">🏆 アイアンマン</option>
                        <option value="リレー">🏆 リレー</option>
                        <option value="アクアスロン">🏆 アクアスロン</option>
                        <option value="デュアスロン">🏆 デュアスロン</option>
                        <option value="キッズ">🏆 キッズ</option>
                        <option value="エイジグループ">🏆 エイジグループ</option>
                        <option value="チーム">🏆 チーム</option>
                    </select>
                </div>

                <div class="filter-group">
                    <label for="search-input">🔍 大会名検索</label>
                    <input type="text" id="search-input" placeholder="大会名を入力...">
                </div>
            </div>
        </div>

        <div class="stats">
            <h3 id="race-count">読み込み中...</h3>
        </div>

        <div class="debug-info" id="debug-info">
            <strong>🐛 デバッグ情報:</strong><br>
            <div id="debug-content">初期化中...</div>
        </div>

        <div class="race-grid" id="race-grid">
            <div style="text-align: center; padding: 40px; color: #666;">
                <h3>大会データを読み込み中...</h3>
            </div>
        </div>
    </div>

    <script>
        // デバッグ用ログ関数
        function debugLog(message) {
            console.log('🐛 DEBUG:', message);
            const debugContent = document.getElementById('debug-content');
            if (debugContent) {
                debugContent.innerHTML += '<br>' + new Date().toLocaleTimeString() + ': ' + message;
            }
        }

        // DOM要素の安全な取得
        function safeGetElement(id) {
            const element = document.getElementById(id);
            if (!element) {
                debugLog(`❌ 要素が見つかりません: ${id}`);
                return null;
            }
            debugLog(`✅ 要素取得成功: ${id}`);
            return element;
        }

        // 大会データ
        const raceData = [
            {
                id: 1,
                name: "石垣島トライアスロン",
                region: "沖縄",
                date: "2025-04-20",
                location: "石垣市",
                distance: "オリンピック",
                description: "美しい海と自然に囲まれた南国のトライアスロン"
            },
            {
                id: 2,
                name: "湘南国際トライアスロン",
                region: "関東",
                date: "2025-05-18",
                location: "藤沢市",
                distance: "オリンピック",
                description: "関東最大級のトライアスロン大会"
            },
            {
                id: 3,
                name: "佐渡国際トライアスロン",
                region: "中部",
                date: "2025-09-07",
                location: "佐渡市",
                distance: "ロング",
                description: "日本最高峰のロングディスタンス"
            },
            {
                id: 4,
                name: "宮古島トライアスロン",
                region: "沖縄",
                date: "2025-04-13",
                location: "宮古島市",
                distance: "ロング",
                description: "エメラルドブルーの海が美しい宮古島"
            },
            {
                id: 5,
                name: "東京トライアスロンフェスタ",
                region: "関東",
                date: "2025-05-25",
                location: "お台場",
                distance: "スプリント",
                description: "都心で開催される人気大会"
            }
        ];

        // アプリケーション状態
        let appState = {
            allRaces: [],
            filteredRaces: [],
            filters: {
                region: '',
                month: '',
                distance: '',
                search: ''
            }
        };

        // DOM要素の参照
        let elements = {};

        // 初期化関数
        function initializeApp() {
            debugLog('🚀 アプリケーション初期化開始');

            // DOM要素の取得
            elements = {
                regionSelect: safeGetElement('region-select'),
                monthSelect: safeGetElement('month-select'),
                distanceSelect: safeGetElement('distance-select'),
                searchInput: safeGetElement('search-input'),
                raceGrid: safeGetElement('race-grid'),
                raceCount: safeGetElement('race-count'),
                debugContent: safeGetElement('debug-content')
            };

            // 必須要素の存在確認
            const requiredElements = ['regionSelect', 'monthSelect', 'distanceSelect', 'searchInput', 'raceGrid', 'raceCount'];
            const missingElements = requiredElements.filter(key => !elements[key]);

            if (missingElements.length > 0) {
                const errorMsg = `❌ 必須DOM要素が見つかりません: ${missingElements.join(', ')}`;
                debugLog(errorMsg);
                console.error(errorMsg);
                return false;
            }

            debugLog('✅ 全てのDOM要素の取得完了');

            // データの初期化
            appState.allRaces = [...raceData];
            appState.filteredRaces = [...raceData];

            debugLog(`📊 大会データ読み込み完了: ${appState.allRaces.length}件`);

            // イベントリスナーの設定
            setupEventListeners();

            // 初期表示
            updateDisplay();

            debugLog('🎉 初期化完了');
            return true;
        }

        // イベントリスナーの設定
        function setupEventListeners() {
            debugLog('🔗 イベントリスナー設定開始');

            if (elements.regionSelect) {
                elements.regionSelect.addEventListener('change', handleFilterChange);
            }
            if (elements.monthSelect) {
                elements.monthSelect.addEventListener('change', handleFilterChange);
            }
            if (elements.distanceSelect) {
                elements.distanceSelect.addEventListener('change', handleFilterChange);
            }
            if (elements.searchInput) {
                elements.searchInput.addEventListener('input', handleFilterChange);
            }

            debugLog('✅ イベントリスナー設定完了');
        }

        // フィルター変更処理
        function handleFilterChange() {
            debugLog('🔄 フィルター変更検出');

            // フィルター値の更新
            appState.filters = {
                region: elements.regionSelect?.value || '',
                month: elements.monthSelect?.value || '',
                distance: elements.distanceSelect?.value || '',
                search: elements.searchInput?.value || ''
            };

            debugLog(`📝 現在のフィルター: ${JSON.stringify(appState.filters)}`);

            // フィルタリング実行
            applyFilters();

            // 表示更新
            updateDisplay();
        }

        // フィルタリング処理
        function applyFilters() {
            appState.filteredRaces = appState.allRaces.filter(race => {
                // 地域フィルター
                if (appState.filters.region && race.region !== appState.filters.region) {
                    return false;
                }

                // 月フィルター
                if (appState.filters.month) {
                    const raceMonth = new Date(race.date).getMonth() + 1;
                    if (raceMonth !== parseInt(appState.filters.month)) {
                        return false;
                    }
                }

                // 距離フィルター
                if (appState.filters.distance && race.distance !== appState.filters.distance) {
                    return false;
                }

                // 検索フィルター
                if (appState.filters.search) {
                    const searchTerm = appState.filters.search.toLowerCase();
                    if (!race.name.toLowerCase().includes(searchTerm) && 
                        !race.location.toLowerCase().includes(searchTerm)) {
                        return false;
                    }
                }

                return true;
            });

            debugLog(`🔍 フィルタリング結果: ${appState.filteredRaces.length}件`);
        }

        // 表示更新
        function updateDisplay() {
            debugLog('🖥️ 表示更新開始');

            // 統計情報の更新
            if (elements.raceCount) {
                elements.raceCount.textContent = `${appState.filteredRaces.length} 件の大会が見つかりました`;
            }

            // 大会一覧の更新
            if (elements.raceGrid) {
                if (appState.filteredRaces.length === 0) {
                    elements.raceGrid.innerHTML = `
                        <div class="no-results">
                            <h3>該当する大会が見つかりませんでした</h3>
                            <p>フィルター条件を変更してお試しください</p>
                        </div>
                    `;
                } else {
                    elements.raceGrid.innerHTML = appState.filteredRaces.map(race => createRaceCard(race)).join('');
                }
            }

            debugLog('✅ 表示更新完了');
        }

        // 大会カードのHTML生成
        function createRaceCard(race) {
            const raceDate = new Date(race.date);
            const formattedDate = raceDate.toLocaleDateString('ja-JP', {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });

            const distanceClass = race.distance.toLowerCase().replace(/[^a-z]/g, '');

            return `
                <div class="race-card">
                    <div class="race-card-header">
                        <h3>${race.name}</h3>
                    </div>
                    <div class="race-card-body">
                        <div class="race-info">
                            <div class="race-info-item">
                                <div class="icon">📅</div>
                                <div class="text">${formattedDate}</div>
                            </div>
                            <div class="race-info-item">
                                <div class="icon">📍</div>
                                <div class="text">${race.location} (${race.region})</div>
                            </div>
                            <div class="race-info-item">
                                <div class="icon">📝</div>
                                <div class="text">${race.description}</div>
                            </div>
                        </div>
                        <div class="distance-badge ${distanceClass}">
                            🏆 ${race.distance}
                        </div>
                    </div>
                </div>
            `;
        }

        // DOMContentLoaded後に初期化
        document.addEventListener('DOMContentLoaded', function() {
            debugLog('📄 DOM読み込み完了');
            
            setTimeout(() => {
                const success = initializeApp();
                if (!success) {
                    debugLog('❌ 初期化失敗');
                    if (elements.raceGrid) {
                        elements.raceGrid.innerHTML = `
                            <div class="no-results">
                                <h3>❌ 初期化エラー</h3>
                                <p>アプリケーションの初期化に失敗しました。ページを再読み込みしてください。</p>
                            </div>
                        `;
                    }
                }
            }, 100);
        });

        // ページ読み込み完了後のフォールバック
        window.addEventListener('load', function() {
            debugLog('🌐 ページ読み込み完了');
            
            // DOM要素が見つからない場合の再試行
            if (!elements.regionSelect) {
                debugLog('🔄 DOM要素再取得を試行');
                setTimeout(() => {
                    initializeApp();
                }, 500);
            }
        });
    </script>
</body>
</html>
