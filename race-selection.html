<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Triathlon AI Coach - ãƒ¬ãƒ¼ã‚¹é¸æŠ</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #dbeafe 0%, #ffffff 50%, #cffafe 100%);
            min-height: 100vh;
            color: #333;
            display: flex;
        }
        .flow-navbar {
            position: fixed; top: 0; left: 0; bottom: 0; width: 240px;
            background: linear-gradient(180deg, #667eea 0%, #764ba2 100%);
            box-shadow: 4px 0 20px rgba(0, 0, 0, 0.1);
            z-index: 1000; padding: 24px 0; overflow-y: auto;
        }
        .flow-nav-logo {
            font-size: 1.3rem; font-weight: 700; color: white; text-align: center;
            padding: 0 20px 30px; margin-bottom: 20px;
            border-bottom: 2px solid rgba(255, 255, 255, 0.2);
        }
        .flow-nav-steps { display: flex; flex-direction: column; gap: 8px; padding: 0 16px; }
        .flow-nav-step {
            display: flex; align-items: center; gap: 12px; padding: 12px 16px;
            border-radius: 10px; font-size: 0.9rem; font-weight: 600;
            text-decoration: none; color: rgba(255, 255, 255, 0.8); transition: all 0.3s;
        }
        .flow-nav-step .nav-icon { font-size: 1.4rem; }
        .flow-nav-step.current { background: rgba(255, 255, 255, 0.25); color: white; }
        .flow-nav-step.available:hover { background: rgba(255, 255, 255, 0.15); color: white; transform: translateX(5px); }
        .content-wrapper { margin-left: 240px; flex: 1; padding: 20px; width: calc(100% - 240px); }
        .container { max-width: 1200px; margin: 0 auto; }
        .header { text-align: center; margin-bottom: 16px; }
        .title { font-size: 24px; font-weight: bold; color: #1f2937; margin-bottom: 4px; }
        .subtitle { font-size: 13px; color: #4b5563; }
        
        .stats-row {
            display: flex; justify-content: center; gap: 20px; margin-bottom: 16px;
            background: white; padding: 12px 20px; border-radius: 10px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.08);
        }
        .stat-item { text-align: center; }
        .stat-number { font-size: 20px; font-weight: bold; color: #2563eb; }
        .stat-label { font-size: 10px; color: #6b7280; }
        
        .selection-panel {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            color: white; border-radius: 10px; padding: 12px 18px; margin-bottom: 16px;
            display: flex; align-items: center; gap: 20px; flex-wrap: wrap;
        }
        .selection-title { font-size: 13px; font-weight: 600; }
        .selection-stat { display: flex; align-items: center; gap: 6px; }
        .selection-stat-number { font-size: 18px; font-weight: bold; }
        .selection-stat-label { font-size: 11px; opacity: 0.9; }
        .goal-button {
            background: white; color: #d97706; border: none; padding: 8px 16px;
            border-radius: 6px; font-weight: 600; cursor: pointer; font-size: 12px; margin-left: auto;
        }
        .goal-button:disabled { opacity: 0.5; cursor: not-allowed; }
        
        .filters-panel {
            background: white; border-radius: 10px; padding: 12px 16px; margin-bottom: 16px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.08);
        }
        .filters-row { display: flex; gap: 10px; flex-wrap: wrap; align-items: center; }
        .filter-group { display: flex; align-items: center; gap: 6px; }
        .filter-label { font-size: 11px; color: #6b7280; font-weight: 600; }
        .filter-select, .filter-input {
            padding: 6px 10px; border: 1px solid #d1d5db; border-radius: 5px; font-size: 12px;
        }
        .filter-input { width: 160px; }
        .filter-select { min-width: 100px; }
        .refresh-btn {
            padding: 6px 12px; background: #3b82f6; color: white; border: none;
            border-radius: 5px; cursor: pointer; font-size: 11px;
        }
        .search-result { margin-left: auto; font-size: 12px; color: #6b7280; }
        
        .races-table {
            background: white; border-radius: 10px; overflow: hidden;
            box-shadow: 0 2px 6px rgba(0,0,0,0.08);
        }
        .race-header-row {
            display: grid;
            grid-template-columns: 50px 100px 1fr 120px 80px 80px;
            gap: 8px; padding: 10px 16px;
            background: #f8fafc; font-size: 11px; font-weight: 600; color: #64748b;
            border-bottom: 1px solid #e2e8f0;
        }
        .race-row {
            display: grid;
            grid-template-columns: 50px 100px 1fr 120px 80px 80px;
            gap: 8px; padding: 10px 16px;
            border-bottom: 1px solid #f1f5f9;
            align-items: center;
            transition: background 0.2s;
        }
        .race-row:hover { background: #f8fafc; }
        .race-row.selected-a { background: #fffbeb; }
        .race-row.selected-other { background: #f5f3ff; }
        
        .race-selection {
            display: flex; gap: 8px; justify-content: center;
        }
        .race-radio {
            display: flex; align-items: center; gap: 3px; cursor: pointer;
        }
        .race-radio input { cursor: pointer; }
        .race-radio label { font-size: 10px; color: #666; cursor: pointer; }
        
        .race-date { font-size: 12px; color: #374151; font-weight: 500; }
        .race-name {
            font-size: 13px; color: #1e40af; font-weight: 500;
            text-decoration: none; cursor: pointer;
        }
        .race-name:hover { text-decoration: underline; color: #1d4ed8; }
        .race-location { font-size: 11px; color: #6b7280; }
        .race-distance {
            font-size: 10px; padding: 2px 8px; border-radius: 10px;
            background: #dbeafe; color: #1e40af; text-align: center;
        }
        .race-category {
            font-size: 10px; padding: 2px 6px; border-radius: 4px;
            background: #f3f4f6; color: #4b5563; text-align: center;
        }
        
        .loading-overlay {
            position: fixed; top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(255, 255, 255, 0.95);
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            z-index: 9999;
        }
        .loading-spinner {
            width: 36px; height: 36px; border: 3px solid #e5e7eb;
            border-top-color: #3b82f6; border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        .loading-text { margin-top: 10px; font-size: 13px; color: #4b5563; }
        @keyframes spin { to { transform: rotate(360deg); } }
        
        .empty-state { text-align: center; padding: 40px; color: #6b7280; }
        .footer { text-align: center; padding: 12px; color: #9ca3af; font-size: 11px; }
        
        @media (max-width: 1024px) {
            .race-header-row, .race-row {
                grid-template-columns: 40px 80px 1fr 100px 70px;
            }
            .race-row > :last-child, .race-header-row > :last-child { display: none; }
        }
        @media (max-width: 768px) {
            .flow-navbar { width: 100%; height: 50px; bottom: auto; padding: 10px; }
            .flow-nav-logo { padding: 0; margin: 0; border: none; font-size: 1rem; }
            .flow-nav-steps { display: none; }
            .content-wrapper { margin-left: 0; padding: 12px; padding-top: 65px; width: 100%; }
            .race-header-row, .race-row {
                grid-template-columns: 35px 70px 1fr 60px;
                font-size: 10px; padding: 8px 10px;
            }
            .race-row > :nth-child(4), .race-header-row > :nth-child(4) { display: none; }
            .race-row > :nth-child(5), .race-header-row > :nth-child(5) { display: none; }
            .race-row > :last-child, .race-header-row > :last-child { display: none; }
        }
    </style>
</head>
<body>
    <nav class="flow-navbar">
        <div class="flow-nav-logo">AI Triathlon Coach</div>
        <div class="flow-nav-steps">
            <a href="home.html" class="flow-nav-step available"><span class="nav-icon">ğŸ </span><span>ãƒ›ãƒ¼ãƒ </span></a>
            <a href="index.html" class="flow-nav-step available"><span class="nav-icon">ğŸ¤–</span><span>AIã‚³ãƒ¼ãƒ</span></a>
            <a href="news.html" class="flow-nav-step available"><span class="nav-icon">ğŸ“°</span><span>ãƒ‹ãƒ¥ãƒ¼ã‚¹</span></a>
            <a href="race-selection.html" class="flow-nav-step current"><span class="nav-icon">ğŸ¯</span><span>ãƒ¬ãƒ¼ã‚¹é¸æŠ</span></a>
            <a href="goal-setting.html" class="flow-nav-step available"><span class="nav-icon">ğŸ†</span><span>ç›®æ¨™è¨­å®š</span></a>
            <a href="training-plan.html" class="flow-nav-step available"><span class="nav-icon">ğŸ“‹</span><span>è¨ˆç”»</span></a>
            <a href="simulator.html" class="flow-nav-step available"><span class="nav-icon">ğŸ”¬</span><span>ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼</span></a>
            <a href="data.html" class="flow-nav-step available"><span class="nav-icon">ğŸ“Š</span><span>é€²æ—</span></a>
        </div>
    </nav>

    <div id="loadingOverlay" class="loading-overlay">
        <div class="loading-spinner"></div>
        <div class="loading-text">ãƒ¬ãƒ¼ã‚¹ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ä¸­...</div>
    </div>

    <div class="content-wrapper">
        <div class="container">
            <div class="header">
                <h1 class="title">ğŸ¯ ãƒ¬ãƒ¼ã‚¹é¸æŠ</h1>
                <p class="subtitle">ç›®æ¨™ãƒ¬ãƒ¼ã‚¹ã‚’é¸æŠã—ã¦ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°è¨ˆç”»ã‚’ç«‹ã¦ã¾ã—ã‚‡ã†</p>
            </div>
            
            <div class="stats-row">
                <div class="stat-item"><div class="stat-number" id="total-count">0</div><div class="stat-label">å…¨å¤§ä¼š</div></div>
                <div class="stat-item"><div class="stat-number" id="japan-count">0</div><div class="stat-label">å›½å†…</div></div>
                <div class="stat-item"><div class="stat-number" id="overseas-count">0</div><div class="stat-label">æµ·å¤–</div></div>
                <div class="stat-item"><div class="stat-number" id="filtered-count">0</div><div class="stat-label">è¡¨ç¤ºä¸­</div></div>
            </div>
            
            <div class="selection-panel">
                <div class="selection-title">ğŸ“Œ é¸æŠä¸­</div>
                <div class="selection-stat">
                    <span class="selection-stat-number" id="a-race-count">0</span>
                    <span class="selection-stat-label">ğŸ†Aãƒ¬ãƒ¼ã‚¹</span>
                </div>
                <div class="selection-stat">
                    <span class="selection-stat-number" id="other-race-count">0</span>
                    <span class="selection-stat-label">ğŸªãã®ä»–</span>
                </div>
                <button class="goal-button" id="goal-setting-button" disabled onclick="goToGoalSetting()">
                    ç›®æ¨™è¨­å®šãƒšãƒ¼ã‚¸ã¸ â†’
                </button>
            </div>
            
            <div class="filters-panel">
                <div class="filters-row">
                    <div class="filter-group">
                        <label class="filter-label">æ¤œç´¢</label>
                        <input type="text" class="filter-input" id="search-input" placeholder="å¤§ä¼šåãƒ»å ´æ‰€...">
                    </div>
                    <div class="filter-group">
                        <label class="filter-label">åœ°åŸŸ</label>
                        <select class="filter-select" id="region-select">
                            <option value="">å…¨ã¦</option>
                            <option value="japan">å›½å†…</option>
                            <option value="overseas">æµ·å¤–</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label class="filter-label">è·é›¢</label>
                        <select class="filter-select" id="distance-select">
                            <option value="">å…¨ã¦</option>
                            <option value="ã‚¹ãƒ—ãƒªãƒ³ãƒˆ">ã‚¹ãƒ—ãƒªãƒ³ãƒˆ</option>
                            <option value="ã‚¹ã‚¿ãƒ³ãƒ€ãƒ¼ãƒ‰">ã‚¹ã‚¿ãƒ³ãƒ€ãƒ¼ãƒ‰</option>
                            <option value="ãƒŸãƒ‰ãƒ«">ãƒŸãƒ‰ãƒ«</option>
                            <option value="ãƒ­ãƒ³ã‚°">ãƒ­ãƒ³ã‚°</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label class="filter-label">æœˆ</label>
                        <select class="filter-select" id="month-select">
                            <option value="">å…¨ã¦</option>
                            <option value="01">1æœˆ</option><option value="02">2æœˆ</option><option value="03">3æœˆ</option>
                            <option value="04">4æœˆ</option><option value="05">5æœˆ</option><option value="06">6æœˆ</option>
                            <option value="07">7æœˆ</option><option value="08">8æœˆ</option><option value="09">9æœˆ</option>
                            <option value="10">10æœˆ</option><option value="11">11æœˆ</option><option value="12">12æœˆ</option>
                        </select>
                    </div>
                    <button class="refresh-btn" onclick="refreshRaces()">ğŸ”„ æ›´æ–°</button>
                    <div class="search-result" id="search-result">0ä»¶</div>
                </div>
            </div>
            
            <div class="races-table">
                <div class="race-header-row">
                    <div>é¸æŠ</div>
                    <div>é–‹å‚¬æ—¥</div>
                    <div>å¤§ä¼šå</div>
                    <div>é–‹å‚¬åœ°</div>
                    <div>è·é›¢</div>
                    <div>ã‚«ãƒ†ã‚´ãƒª</div>
                </div>
                <div id="races-container"></div>
            </div>
            
            <div class="footer">
                <span id="last-updated">æœ€çµ‚æ›´æ–°: --</span>
            </div>
        </div>
    </div>

    <script>
        let races = [];
        let filteredRaces = [];
        let selectedRaces = { aRaces: new Set(), otherRaces: new Set() };
        
        document.addEventListener('DOMContentLoaded', async () => {
            const cached = localStorage.getItem('races_cache_v2');
            if (cached) {
                try {
                    const data = JSON.parse(cached);
                    if (Date.now() - new Date(data.lastUpdated).getTime() < 3600000) {
                        races = data.races;
                        updateStats(data.japanCount, data.overseasCount);
                        filterRaces();
                        document.getElementById('loadingOverlay').style.display = 'none';
                        document.getElementById('last-updated').textContent = 'æœ€çµ‚æ›´æ–°: ' + new Date(data.lastUpdated).toLocaleString('ja-JP');
                        return;
                    }
                } catch (e) {}
            }
            await fetchRacesFromAPI();
        });
        
        async function fetchRacesFromAPI() {
            document.getElementById('loadingOverlay').style.display = 'flex';
            try {
                const response = await fetch('/.netlify/functions/fetch-races');
                if (!response.ok) throw new Error('API error');
                const data = await response.json();
                if (data.success && data.races) {
                    races = data.races;
                    localStorage.setItem('races_cache_v2', JSON.stringify(data));
                    updateStats(data.japanCount, data.overseasCount);
                    filterRaces();
                    document.getElementById('last-updated').textContent = 'æœ€çµ‚æ›´æ–°: ' + new Date(data.lastUpdated).toLocaleString('ja-JP');
                }
            } catch (error) {
                races = getStaticRaces();
                updateStats(
                    races.filter(r => r.country === 'æ—¥æœ¬').length,
                    races.filter(r => r.country !== 'æ—¥æœ¬').length
                );
                filterRaces();
            } finally {
                document.getElementById('loadingOverlay').style.display = 'none';
            }
        }
        
        function getStaticRaces() {
            return [
                { id: '1', name: 'å…¨æ—¥æœ¬ãƒˆãƒ©ã‚¤ã‚¢ã‚¹ãƒ­ãƒ³å®®å¤å³¶å¤§ä¼š', date: '2026-04-19', location: 'æ²–ç¸„çœŒå®®å¤å³¶å¸‚', country: 'æ—¥æœ¬', distance: 'ãƒ­ãƒ³ã‚°', category: 'JTUé¸æ‰‹æ¨©', url: 'https://tri-miyako.com/' },
                { id: '2', name: 'çŸ³å£å³¶ãƒˆãƒ©ã‚¤ã‚¢ã‚¹ãƒ­ãƒ³', date: '2026-04-26', location: 'æ²–ç¸„çœŒçŸ³å£å¸‚', country: 'æ—¥æœ¬', distance: 'ãƒ­ãƒ³ã‚°', category: 'JTUå…¬èª', url: 'https://ishigaki-triathlon.jp/' },
                { id: '3', name: 'ãƒ¯ãƒ¼ãƒ«ãƒ‰ãƒˆãƒ©ã‚¤ã‚¢ã‚¹ãƒ­ãƒ³ã‚·ãƒªãƒ¼ã‚ºæ¨ªæµœ', date: '2026-05-16', location: 'ç¥å¥ˆå·çœŒæ¨ªæµœå¸‚', country: 'æ—¥æœ¬', distance: 'ã‚¹ã‚¿ãƒ³ãƒ€ãƒ¼ãƒ‰', category: 'WTS', url: 'https://yokohamatriathlon.jp/' },
                { id: '4', name: 'ä½æ¸¡å›½éš›ãƒˆãƒ©ã‚¤ã‚¢ã‚¹ãƒ­ãƒ³', date: '2026-09-06', location: 'æ–°æ½ŸçœŒä½æ¸¡å¸‚', country: 'æ—¥æœ¬', distance: 'ãƒ­ãƒ³ã‚°', category: 'JTUé¸æ‰‹æ¨©', url: 'https://www.scsf.jp/' },
                { id: '5', name: 'IRONMAN Japan ã¿ãªã¿åŒ—æµ·é“', date: '2026-09-13', location: 'åŒ—æµ·é“å‡½é¤¨å¸‚', country: 'æ—¥æœ¬', distance: 'ãƒ­ãƒ³ã‚°', category: 'IRONMAN', url: 'https://www.ironman.com/' },
                { id: '6', name: 'IRONMAN 70.3 ã‚»ãƒ³ãƒˆãƒ¬ã‚¢', date: '2026-06-14', location: 'æ„›çŸ¥çœŒå¸¸æ»‘å¸‚', country: 'æ—¥æœ¬', distance: 'ãƒŸãƒ‰ãƒ«', category: 'IRONMAN 70.3', url: 'https://www.ironman.com/' },
                { id: '7', name: 'XTERRA Japan', date: '2026-05-16', location: 'é•·é‡çœŒ', country: 'æ—¥æœ¬', distance: 'ã‚ªãƒ•ãƒ­ãƒ¼ãƒ‰', category: 'XTERRA', url: 'https://www.xterrajapan.com/' },
                { id: '8', name: 'Challenge Taiwan', date: '2026-04-26', location: 'å°æ±', country: 'å°æ¹¾', distance: 'ãƒ­ãƒ³ã‚°', category: 'Challenge', url: 'https://challengefamily.com/' },
                { id: '9', name: 'IRONMAN World Championship', date: '2026-10-10', location: 'ã‚³ãƒŠ', country: 'ã‚¢ãƒ¡ãƒªã‚«', distance: 'ãƒ­ãƒ³ã‚°', category: 'IRONMAN WC', url: 'https://www.ironman.com/' },
                { id: '10', name: 'Challenge Roth', date: '2026-07-05', location: 'ãƒ­ãƒ¼ãƒˆ', country: 'ãƒ‰ã‚¤ãƒ„', distance: 'ãƒ­ãƒ³ã‚°', category: 'Challenge', url: 'https://challengefamily.com/' },
            ];
        }
        
        function refreshRaces() {
            localStorage.removeItem('races_cache_v2');
            fetchRacesFromAPI();
        }
        
        function updateStats(japan, overseas) {
            document.getElementById('total-count').textContent = japan + overseas;
            document.getElementById('japan-count').textContent = japan;
            document.getElementById('overseas-count').textContent = overseas;
        }
        
        function filterRaces() {
            const search = document.getElementById('search-input').value.toLowerCase();
            const region = document.getElementById('region-select').value;
            const distance = document.getElementById('distance-select').value;
            const month = document.getElementById('month-select').value;
            
            filteredRaces = races.filter(r => {
                if (search && !r.name.toLowerCase().includes(search) && !r.location.toLowerCase().includes(search)) return false;
                if (region === 'japan' && r.country !== 'æ—¥æœ¬') return false;
                if (region === 'overseas' && r.country === 'æ—¥æœ¬') return false;
                if (distance && r.distance !== distance && !(distance === 'ãƒŸãƒ‰ãƒ«' && r.distance.includes('70.3'))) return false;
                if (month && r.date.substring(5, 7) !== month) return false;
                return true;
            });
            
            document.getElementById('filtered-count').textContent = filteredRaces.length;
            document.getElementById('search-result').textContent = filteredRaces.length + 'ä»¶';
            renderRaces();
        }
        
        function renderRaces() {
            const container = document.getElementById('races-container');
            if (filteredRaces.length === 0) {
                container.innerHTML = '<div class="empty-state">è©²å½“ã™ã‚‹å¤§ä¼šãŒã‚ã‚Šã¾ã›ã‚“</div>';
                return;
            }
            
            container.innerHTML = filteredRaces.map(race => {
                const isA = selectedRaces.aRaces.has(race.id);
                const isOther = selectedRaces.otherRaces.has(race.id);
                const rowClass = isA ? 'race-row selected-a' : isOther ? 'race-row selected-other' : 'race-row';
                const date = new Date(race.date);
                const dateStr = `${date.getMonth()+1}/${date.getDate()}`;
                const yearStr = date.getFullYear();
                
                return `
                    <div class="${rowClass}" data-id="${race.id}">
                        <div class="race-selection">
                            <div class="race-radio">
                                <input type="radio" name="race_${race.id}" id="a_${race.id}" ${isA ? 'checked' : ''} onchange="selectRace('${race.id}', 'a')">
                                <label for="a_${race.id}">A</label>
                            </div>
                            <div class="race-radio">
                                <input type="radio" name="race_${race.id}" id="o_${race.id}" ${isOther ? 'checked' : ''} onchange="selectRace('${race.id}', 'other')">
                                <label for="o_${race.id}">ä»–</label>
                            </div>
                        </div>
                        <div class="race-date">${yearStr}/${dateStr}</div>
                        <a href="${race.url}" target="_blank" class="race-name">${race.name}</a>
                        <div class="race-location">${race.location}${race.country !== 'æ—¥æœ¬' ? ' ('+race.country+')' : ''}</div>
                        <div class="race-distance">${race.distance}</div>
                        <div class="race-category">${race.category || ''}</div>
                    </div>
                `;
            }).join('');
        }
        
        function selectRace(raceId, type) {
            // åŒã˜ãƒ¬ãƒ¼ã‚¹ã®åˆ¥é¸æŠã‚’è§£é™¤
            selectedRaces.aRaces.delete(raceId);
            selectedRaces.otherRaces.delete(raceId);
            
            // æ–°ã—ã„é¸æŠã‚’è¿½åŠ ï¼ˆå†ã‚¯ãƒªãƒƒã‚¯ã§è§£é™¤ï¼‰
            const radio = document.querySelector(`#${type === 'a' ? 'a' : 'o'}_${raceId}`);
            if (type === 'a') {
                selectedRaces.aRaces.add(raceId);
            } else {
                selectedRaces.otherRaces.add(raceId);
            }
            
            updateSelectionStats();
            renderRaces();
        }
        
        function updateSelectionStats() {
            const total = selectedRaces.aRaces.size + selectedRaces.otherRaces.size;
            document.getElementById('a-race-count').textContent = selectedRaces.aRaces.size;
            document.getElementById('other-race-count').textContent = selectedRaces.otherRaces.size;
            const btn = document.getElementById('goal-setting-button');
            btn.disabled = total === 0;
            btn.textContent = total > 0 ? `ç›®æ¨™è¨­å®šãƒšãƒ¼ã‚¸ã¸ (${total}ä»¶) â†’` : 'ç›®æ¨™è¨­å®šãƒšãƒ¼ã‚¸ã¸ â†’';
        }
        
        function goToGoalSetting() {
            const data = {
                aRaces: [...selectedRaces.aRaces],
                otherRaces: [...selectedRaces.otherRaces],
                raceDetails: {}
            };
            [...selectedRaces.aRaces, ...selectedRaces.otherRaces].forEach(id => {
                const race = races.find(r => r.id === id);
                if (race) data.raceDetails[id] = race;
            });
            localStorage.setItem('selected_races', JSON.stringify(data));
            window.location.href = 'goal-setting.html';
        }
        
        document.getElementById('search-input').addEventListener('input', filterRaces);
        document.getElementById('region-select').addEventListener('change', filterRaces);
        document.getElementById('distance-select').addEventListener('change', filterRaces);
        document.getElementById('month-select').addEventListener('change', filterRaces);
    </script>
</body>
</html>
