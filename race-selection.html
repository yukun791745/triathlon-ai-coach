<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aãƒ¬ãƒ¼ã‚¹é¸æŠ - Triathlon AI Coach</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #ff6b6b, #ffd93d, #6bcf7f);
            padding: 30px;
            text-align: center;
            color: white;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .controls {
            padding: 30px;
            background: #f8f9fa;
            border-bottom: 1px solid #e9ecef;
        }

        .filter-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
        }

        .filter-group label {
            font-weight: 600;
            margin-bottom: 8px;
            color: #495057;
        }

        .filter-group select, .filter-group input {
            padding: 12px;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .filter-group select:focus, .filter-group input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .search-bar {
            position: relative;
        }

        .search-bar input {
            width: 100%;
            padding-left: 45px;
        }

        .search-bar::before {
            content: "ğŸ”";
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 1.2rem;
        }

        .stats {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 5px;
        }

        .stats-info {
            color: #6c757d;
            font-size: 0.9rem;
        }

        .view-toggle {
            display: flex;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .view-toggle button {
            padding: 8px 16px;
            border: none;
            background: white;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .view-toggle button.active {
            background: #667eea;
            color: white;
        }

        .race-list {
            padding: 30px;
        }

        .race-card {
            background: white;
            border: 2px solid #e9ecef;
            border-radius: 15px;
            margin-bottom: 20px;
            overflow: hidden;
            transition: all 0.3s ease;
            position: relative;
        }

        .race-card:hover {
            border-color: #667eea;
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
        }

        .race-card.a-race {
            border-color: #dc3545;
            border-width: 3px;
            background: linear-gradient(135deg, #fff5f5, #ffffff);
            box-shadow: 0 4px 15px rgba(220, 53, 69, 0.2);
        }

        .race-card.other-race {
            border-color: #28a745;
            border-width: 3px;
            background: linear-gradient(135deg, #f8fff9, #ffffff);
            box-shadow: 0 4px 15px rgba(40, 167, 69, 0.2);
        }



        .race-header {
            padding: 20px;
            border-bottom: 1px solid #e9ecef;
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            position: relative;
        }

        .race-title {
            flex: 1;
            padding-right: 20px;
        }

        .race-title h3 {
            font-size: 1.3rem;
            color: #212529;
            margin-bottom: 5px;
        }

        .race-subtitle {
            color: #6c757d;
            font-size: 0.9rem;
        }

        .race-actions {
            display: flex;
            flex-direction: column;
            gap: 10px;
            align-items: flex-end;
        }

        .website-link {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 8px 16px;
            background: #667eea;
            color: white;
            text-decoration: none;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .website-link:hover {
            background: #5a67d8;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }

        .race-selection-buttons {
            display: flex;
            gap: 8px;
        }

        .priority-button {
            padding: 8px 16px;
            border: 2px solid;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .priority-button.a-race-btn {
            border-color: #dc3545;
            color: #dc3545;
            background: white;
        }

        .priority-button.a-race-btn.selected {
            background: #dc3545;
            color: white;
        }

        .priority-button.other-race-btn {
            border-color: #28a745;
            color: #28a745;
            background: white;
        }

        .priority-button.other-race-btn.selected {
            background: #28a745;
            color: white;
        }

        .priority-button:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        .race-category {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .category-sprint {
            background: #e3f2fd;
            color: #1565c0;
        }

        .category-od {
            background: #f3e5f5;
            color: #7b1fa2;
        }

        .category-middle {
            background: #fff3e0;
            color: #ef6c00;
        }

        .category-long {
            background: #ffebee;
            color: #c62828;
        }

        .race-details {
            padding: 20px;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .detail-item {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .detail-icon {
            font-size: 1.2rem;
        }

        .detail-text {
            font-size: 0.9rem;
        }

        .detail-label {
            font-weight: 600;
            color: #495057;
        }

        .detail-value {
            color: #6c757d;
        }

        .status-badge {
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .status-entry {
            background: #d4edda;
            color: #155724;
        }

        .status-scheduled {
            background: #cce5ff;
            color: #004085;
        }

        .selection-actions {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            padding: 20px;
            min-width: 300px;
            display: none;
        }

        .selection-actions.show {
            display: block;
            animation: slideUp 0.3s ease;
        }

        .selection-summary {
            margin-bottom: 15px;
        }

        .selection-summary h4 {
            color: #495057;
            margin-bottom: 10px;
        }

        .summary-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 5px 0;
            font-size: 0.9rem;
        }

        .summary-label {
            font-weight: 600;
        }

        .summary-count {
            background: #e9ecef;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 0.8rem;
        }

        .action-buttons {
            display: flex;
            gap: 10px;
        }

        .action-button {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .primary-button {
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
        }

        .secondary-button {
            background: #f8f9fa;
            color: #495057;
            border: 1px solid #dee2e6;
        }

        .action-button:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #6c757d;
        }

        .empty-state-icon {
            font-size: 4rem;
            margin-bottom: 20px;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 2rem;
            }
            
            .filter-section {
                grid-template-columns: 1fr;
            }
            
            .race-details {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸŠâ€â™‚ï¸ğŸš´â€â™‚ï¸ğŸƒâ€â™‚ï¸ ãƒ¬ãƒ¼ã‚¹é¸æŠãƒ»ç®¡ç†</h1>
            <p>å‚åŠ äºˆå®šã®å¤§ä¼šã‚’é¸æŠãƒ»ç®¡ç†ã§ãã‚‹ãƒ¯ãƒ³ã‚¹ãƒˆãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒ—</p>
        </div>

        <div class="controls">
            <div class="filter-section">
                <div class="filter-group">
                    <label for="categoryFilter">ã‚«ãƒ†ã‚´ãƒªãƒ¼</label>
                    <select id="categoryFilter">
                        <option value="">ã™ã¹ã¦</option>
                        <option value="Sprint">ã‚¹ãƒ—ãƒªãƒ³ãƒˆ</option>
                        <option value="OD">ã‚ªãƒªãƒ³ãƒ”ãƒƒã‚¯ãƒ‡ã‚£ã‚¹ã‚¿ãƒ³ã‚¹</option>
                        <option value="Middle">ãƒŸãƒ‰ãƒ«</option>
                        <option value="Long">ãƒ­ãƒ³ã‚°</option>
                    </select>
                </div>
                
                <div class="filter-group">
                    <label for="prefectureFilter">é–‹å‚¬åœ°</label>
                    <select id="prefectureFilter">
                        <option value="">ã™ã¹ã¦</option>
                        <option value="æ±äº¬éƒ½">æ±äº¬éƒ½</option>
                        <option value="ç¥å¥ˆå·çœŒ">ç¥å¥ˆå·çœŒ</option>
                        <option value="æ„›çŸ¥çœŒ">æ„›çŸ¥çœŒ</option>
                        <option value="æ²–ç¸„çœŒ">æ²–ç¸„çœŒ</option>
                        <option value="æ–°æ½ŸçœŒ">æ–°æ½ŸçœŒ</option>
                        <option value="å¤§é˜ªåºœ">å¤§é˜ªåºœ</option>
                        <option value="å®®åŸçœŒ">å®®åŸçœŒ</option>
                    </select>
                </div>
                
                <div class="filter-group">
                    <label for="monthFilter">é–‹å‚¬æœˆ</label>
                    <select id="monthFilter">
                        <option value="">ã™ã¹ã¦</option>
                        <option value="04">4æœˆ</option>
                        <option value="05">5æœˆ</option>
                        <option value="06">6æœˆ</option>
                        <option value="07">7æœˆ</option>
                        <option value="08">8æœˆ</option>
                        <option value="09">9æœˆ</option>
                        <option value="10">10æœˆ</option>
                    </select>
                </div>
                
                <div class="filter-group search-bar">
                    <label for="searchInput">å¤§ä¼šåæ¤œç´¢</label>
                    <input type="text" id="searchInput" placeholder="å¤§ä¼šåã‚’å…¥åŠ›...">
                </div>
            </div>
            
            <div class="stats">
                <div class="stats-info">
                    <span id="raceCount">0</span> ä»¶ã®å¤§ä¼šãŒè¦‹ã¤ã‹ã‚Šã¾ã—ãŸ
                </div>
                <div class="view-toggle">
                    <button class="active" onclick="setView('card', this)">ã‚«ãƒ¼ãƒ‰è¡¨ç¤º</button>
                    <button onclick="setView('list', this)">ãƒªã‚¹ãƒˆè¡¨ç¤º</button>
                </div>
            </div>
        </div>

        <div class="race-list" id="raceList">
            <!-- å¤§ä¼šã‚«ãƒ¼ãƒ‰ãŒã“ã“ã«å‹•çš„ã«ç”Ÿæˆã•ã‚Œã¾ã™ -->
        </div>
    </div>

    <div class="selection-actions" id="selectionActions">
        <div class="selection-summary">
            <h4>é¸æŠä¸­ã®ãƒ¬ãƒ¼ã‚¹</h4>
            <div class="summary-item">
                <span class="summary-label">Aãƒ¬ãƒ¼ã‚¹:</span>
                <span class="summary-count" id="aRaceCount">0</span>
            </div>
            <div class="summary-item">
                <span class="summary-label">ãã®ä»–ã®ãƒ¬ãƒ¼ã‚¹:</span>
                <span class="summary-count" id="otherRaceCount">0</span>
            </div>
        </div>
        <div class="action-buttons">
            <button class="action-button secondary-button" onclick="clearAllSelections()">
                ã‚¯ãƒªã‚¢
            </button>
            <button class="action-button primary-button" onclick="proceedToGoalSetting()">
                ç›®æ¨™è¨­å®šã¸
            </button>
        </div>
    </div>

    <script>
        // ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿
        const raceData = [
            {
                'id': 'tokyo-bay-tri-2025',
                'name': 'æ±äº¬ãƒ™ã‚¤ãƒˆãƒ©ã‚¤ã‚¢ã‚¹ãƒ­ãƒ³',
                'date': '2025-06-15',
                'category': 'OD',
                'location': {
                    'prefecture': 'æ±äº¬éƒ½',
                    'city': 'æ±Ÿæ±åŒº',
                    'venue': 'ãŠå°å ´æµ·æµœå…¬åœ’',
                    'full_text': 'æ±äº¬éƒ½æ±Ÿæ±åŒºãŠå°å ´æµ·æµœå…¬åœ’'
                },
                'entry_period': '2025å¹´3æœˆ1æ—¥ã€œ5æœˆ31æ—¥',
                'source': 'JTU',
                'url': 'https://www.jtu.or.jp/event/example1',
                'status': 'ã‚¨ãƒ³ãƒˆãƒªãƒ¼ä¸­'
            },
            {
                'id': 'shonan-tri-2025',
                'name': 'æ¹˜å—ãƒˆãƒ©ã‚¤ã‚¢ã‚¹ãƒ­ãƒ³',
                'date': '2025-07-20',
                'category': 'Sprint',
                'location': {
                    'prefecture': 'ç¥å¥ˆå·çœŒ',
                    'city': 'è—¤æ²¢å¸‚',
                    'venue': 'ç‰‡ç€¬æµ·å²¸',
                    'full_text': 'ç¥å¥ˆå·çœŒè—¤æ²¢å¸‚ç‰‡ç€¬æµ·å²¸'
                },
                'entry_period': '2025å¹´4æœˆ1æ—¥ã€œ6æœˆ30æ—¥',
                'source': 'JTU',
                'url': 'https://www.jtu.or.jp/event/example2',
                'status': 'é–‹å‚¬äºˆå®š'
            },
            {
                'id': 'yokohama-wts-2025',
                'name': '2025ãƒ¯ãƒ¼ãƒ«ãƒ‰ãƒˆãƒ©ã‚¤ã‚¢ã‚¹ãƒ­ãƒ³ãƒãƒ£ãƒ³ãƒ”ã‚ªãƒ³ã‚·ãƒƒãƒ—ã‚·ãƒªãƒ¼ã‚ºæ¨ªæµœå¤§ä¼š',
                'date': '2025-05-17',
                'category': 'OD',
                'location': {
                    'prefecture': 'ç¥å¥ˆå·çœŒ',
                    'city': 'æ¨ªæµœå¸‚',
                    'venue': 'å±±ä¸‹å…¬åœ’å‘¨è¾º',
                    'full_text': 'ç¥å¥ˆå·çœŒæ¨ªæµœå¸‚å±±ä¸‹å…¬åœ’å‘¨è¾º'
                },
                'entry_period': '2024å¹´10æœˆ10æ—¥ã€œ2025å¹´3æœˆ31æ—¥',
                'source': 'JTU',
                'url': 'https://www.jtu.or.jp/event/yokohama2025',
                'status': 'ã‚¨ãƒ³ãƒˆãƒªãƒ¼ä¸­'
            },
            {
                'id': 'gamagori-tri-2025',
                'name': 'è’²éƒ¡ãƒˆãƒ©ã‚¤ã‚¢ã‚¹ãƒ­ãƒ³å…¨æ—¥æœ¬é¸æ‰‹æ¨©',
                'date': '2025-06-08',
                'category': 'OD',
                'location': {
                    'prefecture': 'æ„›çŸ¥çœŒ',
                    'city': 'è’²éƒ¡å¸‚',
                    'venue': 'è’²éƒ¡æµ·å²¸',
                    'full_text': 'æ„›çŸ¥çœŒè’²éƒ¡å¸‚è’²éƒ¡æµ·å²¸'
                },
                'entry_period': '2025å¹´2æœˆ1æ—¥ã€œ4æœˆ30æ—¥',
                'source': 'JTU',
                'url': 'https://www.jtu.or.jp/event/gamagori2025',
                'status': 'é–‹å‚¬äºˆå®š'
            },
            {
                'id': 'miyakojima-tri-2025',
                'name': 'å®®å¤å³¶ãƒˆãƒ©ã‚¤ã‚¢ã‚¹ãƒ­ãƒ³',
                'date': '2025-04-20',
                'category': 'Long',
                'location': {
                    'prefecture': 'æ²–ç¸„çœŒ',
                    'city': 'å®®å¤å³¶å¸‚',
                    'venue': 'ä¸‹åœ°å³¶ç©ºæ¸¯å‘¨è¾º',
                    'full_text': 'æ²–ç¸„çœŒå®®å¤å³¶å¸‚ä¸‹åœ°å³¶ç©ºæ¸¯å‘¨è¾º'
                },
                'entry_period': '2024å¹´12æœˆ1æ—¥ã€œ2025å¹´2æœˆ28æ—¥',
                'source': 'JTU',
                'url': 'https://www.jtu.or.jp/event/miyakojima2025',
                'status': 'é–‹å‚¬äºˆå®š'
            },
            {
                'id': 'sado-tri-2025',
                'name': 'ä½æ¸¡å›½éš›ãƒˆãƒ©ã‚¤ã‚¢ã‚¹ãƒ­ãƒ³',
                'date': '2025-09-07',
                'category': 'Long',
                'location': {
                    'prefecture': 'æ–°æ½ŸçœŒ',
                    'city': 'ä½æ¸¡å¸‚',
                    'venue': 'ä½æ¸¡å³¶',
                    'full_text': 'æ–°æ½ŸçœŒä½æ¸¡å¸‚ä½æ¸¡å³¶'
                },
                'entry_period': '2025å¹´3æœˆ1æ—¥ã€œ6æœˆ30æ—¥',
                'source': 'JTU',
                'url': 'https://www.jtu.or.jp/event/sado2025',
                'status': 'é–‹å‚¬äºˆå®š'
            },
            {
                'id': 'ishigaki-tri-2025',
                'name': 'çŸ³å£å³¶ãƒˆãƒ©ã‚¤ã‚¢ã‚¹ãƒ­ãƒ³',
                'date': '2025-04-13',
                'category': 'OD',
                'location': {
                    'prefecture': 'æ²–ç¸„çœŒ',
                    'city': 'çŸ³å£å¸‚',
                    'venue': 'çŸ³å£å³¶',
                    'full_text': 'æ²–ç¸„çœŒçŸ³å£å¸‚çŸ³å£å³¶'
                },
                'entry_period': '2024å¹´12æœˆ1æ—¥ã€œ3æœˆ15æ—¥',
                'source': 'JTU',
                'url': 'https://www.jtu.or.jp/event/ishigaki2025',
                'status': 'ã‚¨ãƒ³ãƒˆãƒªãƒ¼ä¸­'
            },
            {
                'id': 'tokyo-sprint-2025',
                'name': 'æ±äº¬ã‚¹ãƒ—ãƒªãƒ³ãƒˆãƒˆãƒ©ã‚¤ã‚¢ã‚¹ãƒ­ãƒ³',
                'date': '2025-05-25',
                'category': 'Sprint',
                'location': {
                    'prefecture': 'æ±äº¬éƒ½',
                    'city': 'æ±Ÿæ±åŒº',
                    'venue': 'ãŠå°å ´æµ·æµœå…¬åœ’',
                    'full_text': 'æ±äº¬éƒ½æ±Ÿæ±åŒºãŠå°å ´æµ·æµœå…¬åœ’'
                },
                'entry_period': '2025å¹´2æœˆ1æ—¥ã€œ4æœˆ30æ—¥',
                'source': 'JTU',
                'url': 'https://www.jtu.or.jp/event/tokyosprint2025',
                'status': 'é–‹å‚¬äºˆå®š'
            },
            {
                'id': 'osaka-tri-2025',
                'name': 'å¤§é˜ªãƒˆãƒ©ã‚¤ã‚¢ã‚¹ãƒ­ãƒ³èˆæ´²',
                'date': '2025-10-12',
                'category': 'OD',
                'location': {
                    'prefecture': 'å¤§é˜ªåºœ',
                    'city': 'å¤§é˜ªå¸‚',
                    'venue': 'èˆæ´²',
                    'full_text': 'å¤§é˜ªåºœå¤§é˜ªå¸‚èˆæ´²'
                },
                'entry_period': '2025å¹´6æœˆ1æ—¥ã€œ9æœˆ15æ—¥',
                'source': 'JTU',
                'url': 'https://www.jtu.or.jp/event/osaka2025',
                'status': 'ã‚¨ãƒ³ãƒˆãƒªãƒ¼ä¸­'
            },
            {
                'id': 'tohoku-tri-2025',
                'name': 'æ±åŒ—ãƒˆãƒ©ã‚¤ã‚¢ã‚¹ãƒ­ãƒ³é¸æ‰‹æ¨©',
                'date': '2025-08-17',
                'category': 'Middle',
                'location': {
                    'prefecture': 'å®®åŸçœŒ',
                    'city': 'ä¸ƒãƒ¶æµœç”º',
                    'venue': 'ä¸ƒãƒ¶æµœæµ·å²¸',
                    'full_text': 'å®®åŸçœŒä¸ƒãƒ¶æµœç”ºä¸ƒãƒ¶æµœæµ·å²¸'
                },
                'entry_period': '2025å¹´5æœˆ1æ—¥ã€œ7æœˆ31æ—¥',
                'source': 'JTU',
                'url': 'https://www.jtu.or.jp/event/tohoku2025',
                'status': 'é–‹å‚¬äºˆå®š'
            }
        ];

        let filteredRaces = [...raceData];
        let selectedRaces = {
            aRace: null,
            otherRaces: []
        };
        let currentView = 'card';

        // ãƒ¬ãƒ¼ã‚¹å„ªå…ˆåº¦è¨­å®šï¼ˆãƒˆã‚°ãƒ«æ©Ÿèƒ½ä»˜ãï¼‰
        function setRacePriority(raceId, priority) {
            const race = raceData.find(r => r.id === raceId);
            if (!race) return;

            if (priority === 'a-race') {
                // æ—¢ã«Aãƒ¬ãƒ¼ã‚¹ã«è¨­å®šã•ã‚Œã¦ã„ã‚‹å ´åˆã¯è§£é™¤
                if (selectedRaces.aRace?.id === raceId) {
                    selectedRaces.aRace = null;
                } else {
                    // Aãƒ¬ãƒ¼ã‚¹ã¯1ã¤ã®ã¿
                    selectedRaces.aRace = race;
                    // ã‚‚ã—æ—¢ã«ãã®ä»–ã®ãƒ¬ãƒ¼ã‚¹ã«å…¥ã£ã¦ã„ãŸã‚‰å‰Šé™¤
                    selectedRaces.otherRaces = selectedRaces.otherRaces.filter(r => r.id !== raceId);
                }
            } else if (priority === 'other-race') {
                // æ—¢ã«ãã®ä»–ã®ãƒ¬ãƒ¼ã‚¹ã«å…¥ã£ã¦ã„ã‚‹å ´åˆã¯å‰Šé™¤
                if (selectedRaces.otherRaces.some(r => r.id === raceId)) {
                    selectedRaces.otherRaces = selectedRaces.otherRaces.filter(r => r.id !== raceId);
                } else {
                    // ãã®ä»–ã®ãƒ¬ãƒ¼ã‚¹ã«è¿½åŠ 
                    selectedRaces.otherRaces.push(race);
                    // ã‚‚ã—Aãƒ¬ãƒ¼ã‚¹ã ã£ãŸã‚‰å‰Šé™¤
                    if (selectedRaces.aRace?.id === raceId) {
                        selectedRaces.aRace = null;
                    }
                }
            }

            updateSelectionSummary();
            renderRaces();
        }

        // é¸æŠè§£é™¤
        function removeRaceSelection(raceId) {
            if (selectedRaces.aRace?.id === raceId) {
                selectedRaces.aRace = null;
            }
            selectedRaces.otherRaces = selectedRaces.otherRaces.filter(r => r.id !== raceId);
            
            updateSelectionSummary();
            renderRaces();
        }

        // é¸æŠã‚µãƒãƒªãƒ¼æ›´æ–°
        function updateSelectionSummary() {
            const totalSelected = (selectedRaces.aRace ? 1 : 0) + selectedRaces.otherRaces.length;
            console.log(`é¸æŠä¸­: Aãƒ¬ãƒ¼ã‚¹ ${selectedRaces.aRace ? 1 : 0}ä»¶, ãã®ä»– ${selectedRaces.otherRaces.length}ä»¶`);
        }

        // ãƒ¬ãƒ¼ã‚¹ã‚«ãƒ¼ãƒ‰ã®ã‚¯ãƒ©ã‚¹å–å¾—
        function getSelectedRaceClass(raceId) {
            if (selectedRaces.aRace?.id === raceId) {
                return 'a-race';
            } else if (selectedRaces.otherRaces.some(r => r.id === raceId)) {
                return 'other-race';
            }
            return '';
        }

        // ãƒ¬ãƒ¼ã‚¹å„ªå…ˆåº¦ãƒãƒƒã‚¸å–å¾—ï¼ˆå‰Šé™¤æ¸ˆã¿ï¼‰
        function getSelectedRaceBadge(raceId) {
            return ''; // ãƒãƒƒã‚¸ã¯æ ç·šã§ä»£æ›¿
        }

        // ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ãƒ»æ¤œç´¢æ©Ÿèƒ½
        function applyFilters() {
            const categoryFilter = document.getElementById('categoryFilter').value;
            const prefectureFilter = document.getElementById('prefectureFilter').value;
            const monthFilter = document.getElementById('monthFilter').value;
            const searchQuery = document.getElementById('searchInput').value.toLowerCase();

            filteredRaces = raceData.filter(race => {
                const matchesCategory = !categoryFilter || race.category === categoryFilter;
                const matchesPrefecture = !prefectureFilter || race.location.prefecture === prefectureFilter;
                const matchesMonth = !monthFilter || race.date.substring(5, 7) === monthFilter;
                const matchesSearch = !searchQuery || race.name.toLowerCase().includes(searchQuery);
                
                return matchesCategory && matchesPrefecture && matchesMonth && matchesSearch;
            });

            renderRaces();
        }

        // å¤§ä¼šã‚«ãƒ¼ãƒ‰/ãƒªã‚¹ãƒˆã®è¡¨ç¤º
        function renderRaces() {
            const raceList = document.getElementById('raceList');
            const raceCount = document.getElementById('raceCount');
            
            raceCount.textContent = filteredRaces.length;

            if (filteredRaces.length === 0) {
                raceList.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">ğŸ”</div>
                        <h3>è©²å½“ã™ã‚‹å¤§ä¼šãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸ</h3>
                        <p>ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼æ¡ä»¶ã‚’å¤‰æ›´ã—ã¦ãŠè©¦ã—ãã ã•ã„</p>
                    </div>
                `;
                return;
            }

            raceList.innerHTML = filteredRaces.map(race => `
                <div class="race-card ${getSelectedRaceClass(race.id)}" id="race-${race.id}">
                    <div class="race-header">
                        <div class="race-title">
                            <h3>${race.name}</h3>
                            <div class="race-subtitle">${formatDate(race.date)} é–‹å‚¬</div>
                        </div>
                        <div class="race-actions">
                            <a href="${race.url}" target="_blank" class="website-link">
                                å¤§ä¼šã‚µã‚¤ãƒˆ ğŸ”—
                            </a>
                            <div class="race-category category-${race.category.toLowerCase()}">
                                ${getCategoryLabel(race.category)}
                            </div>
                            <div class="race-selection-buttons">
                                <button class="priority-button a-race-btn ${selectedRaces.aRace?.id === race.id ? 'selected' : ''}" 
                                        onclick="setRacePriority('${race.id}', 'a-race')">
                                    Aãƒ¬ãƒ¼ã‚¹
                                </button>
                                <button class="priority-button other-race-btn ${selectedRaces.otherRaces.some(r => r.id === race.id) ? 'selected' : ''}" 
                                        onclick="setRacePriority('${race.id}', 'other-race')">
                                    ãã®ä»–
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="race-details">
                        <div class="detail-item">
                            <div class="detail-icon">ğŸ“…</div>
                            <div class="detail-text">
                                <div class="detail-label">é–‹å‚¬æ—¥</div>
                                <div class="detail-value">${formatDate(race.date)}</div>
                            </div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-icon">ğŸ“</div>
                            <div class="detail-text">
                                <div class="detail-label">é–‹å‚¬åœ°</div>
                                <div class="detail-value">${race.location.full_text}</div>
                            </div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-icon">ğŸ“</div>
                            <div class="detail-text">
                                <div class="detail-label">ã‚¨ãƒ³ãƒˆãƒªãƒ¼æœŸé–“</div>
                                <div class="detail-value">${race.entry_period}</div>
                            </div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-icon">ğŸ·ï¸</div>
                            <div class="detail-text">
                                <div class="detail-label">ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</div>
                                <div class="detail-value">
                                    <span class="status-badge ${race.status === 'ã‚¨ãƒ³ãƒˆãƒªãƒ¼ä¸­' ? 'status-entry' : 'status-scheduled'}">
                                        ${race.status}
                                    </span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // ãƒ¬ãƒ¼ã‚¹é¸æŠçŠ¶æ…‹ã®æ›´æ–°
        function updateSelectionSummary() {
            const aRaceCount = selectedRaces.aRace ? 1 : 0;
            const otherRaceCount = selectedRaces.otherRaces.length;
            const totalSelected = aRaceCount + otherRaceCount;
            
            // ã‚µãƒãƒªãƒ¼è¡¨ç¤ºã®æ›´æ–°
            document.getElementById('aRaceCount').textContent = aRaceCount;
            document.getElementById('otherRaceCount').textContent = otherRaceCount;
            
            // é¸æŠã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒ‘ãƒãƒ«ã®è¡¨ç¤º/éè¡¨ç¤º
            const selectionActions = document.getElementById('selectionActions');
            if (totalSelected > 0) {
                selectionActions.classList.add('show');
            } else {
                selectionActions.classList.remove('show');
            }
        }

        // å…¨é¸æŠã‚¯ãƒªã‚¢
        function clearAllSelections() {
            selectedRaces.aRace = null;
            selectedRaces.otherRaces = [];
            updateSelectionSummary();
            renderRaces();
        }

        // ç›®æ¨™è¨­å®šã¸é€²ã‚€
        function proceedToGoalSetting() {
            const totalSelected = (selectedRaces.aRace ? 1 : 0) + selectedRaces.otherRaces.length;
            
            if (totalSelected === 0) {
                alert('å‚åŠ äºˆå®šã®ãƒ¬ãƒ¼ã‚¹ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚');
                return;
            }
            
            if (!selectedRaces.aRace) {
                const confirm = window.confirm('Aãƒ¬ãƒ¼ã‚¹ãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚\n\nAãƒ¬ãƒ¼ã‚¹ã¯æœ€ã‚‚é‡è¦ãªç›®æ¨™ãƒ¬ãƒ¼ã‚¹ã§ã™ã€‚\nã€Œãã®ä»–ã®ãƒ¬ãƒ¼ã‚¹ã€ã‹ã‚‰1ã¤ã‚’Aãƒ¬ãƒ¼ã‚¹ã«å¤‰æ›´ã—ã¾ã™ã‹ï¼Ÿ');
                if (!confirm) return;
            }
            
            console.log('Selected races:', selectedRaces);
            alert(`ãƒ¬ãƒ¼ã‚¹é¸æŠå®Œäº†ï¼\n\nAãƒ¬ãƒ¼ã‚¹: ${selectedRaces.aRace ? selectedRaces.aRace.name : 'ãªã—'}\nãã®ä»–ã®ãƒ¬ãƒ¼ã‚¹: ${selectedRaces.otherRaces.length}ä»¶\n\næ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—ï¼šç›®æ¨™ã‚¿ã‚¤ãƒ è¨­å®šã«é€²ã¿ã¾ã™ã€‚`);
            
            // å®Ÿéš›ã®ã‚¢ãƒ—ãƒªã§ã¯ã€ã“ã“ã§ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜ã—ã€æ¬¡ã®ç”»é¢ã«é·ç§»
        }

        // ãƒ“ãƒ¥ãƒ¼åˆ‡ã‚Šæ›¿ãˆ
        function setView(view, buttonElement) {
            currentView = view;
            document.querySelectorAll('.view-toggle button').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // ã‚¯ãƒªãƒƒã‚¯ã•ã‚ŒãŸãƒœã‚¿ãƒ³ã‚’ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã«ã™ã‚‹
            buttonElement.classList.add('active');
            
            // ãƒ“ãƒ¥ãƒ¼åˆ‡ã‚Šæ›¿ãˆã®ãƒ­ã‚¸ãƒƒã‚¯ï¼ˆç¾åœ¨ã¯ã‚«ãƒ¼ãƒ‰è¡¨ç¤ºã®ã¿å®Ÿè£…ï¼‰
            if (view === 'list') {
                // ãƒªã‚¹ãƒˆè¡¨ç¤ºã®å®Ÿè£…ï¼ˆå°†æ¥çš„ã«ï¼‰
                console.log('ãƒªã‚¹ãƒˆè¡¨ç¤ºã«åˆ‡ã‚Šæ›¿ãˆ');
                alert('ãƒªã‚¹ãƒˆè¡¨ç¤ºæ©Ÿèƒ½ã¯ä»Šå¾Œå®Ÿè£…äºˆå®šã§ã™');
            } else {
                // ã‚«ãƒ¼ãƒ‰è¡¨ç¤ºï¼ˆç¾åœ¨ã®è¡¨ç¤ºï¼‰
                console.log('ã‚«ãƒ¼ãƒ‰è¡¨ç¤ºã«åˆ‡ã‚Šæ›¿ãˆ');
            }
        }

        // ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£é–¢æ•°
        function formatDate(dateString) {
            const date = new Date(dateString);
            return `${date.getFullYear()}å¹´${date.getMonth() + 1}æœˆ${date.getDate()}æ—¥`;
        }

        function getCategoryLabel(category) {
            const labels = {
                'Sprint': 'ã‚¹ãƒ—ãƒªãƒ³ãƒˆ',
                'OD': 'ã‚ªãƒªãƒ³ãƒ”ãƒƒã‚¯',
                'Middle': 'ãƒŸãƒ‰ãƒ«',
                'Long': 'ãƒ­ãƒ³ã‚°'
            };
            return labels[category] || category;
        }

        // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
        document.getElementById('categoryFilter').addEventListener('change', applyFilters);
        document.getElementById('prefectureFilter').addEventListener('change', applyFilters);
        document.getElementById('monthFilter').addEventListener('change', applyFilters);
        document.getElementById('searchInput').addEventListener('input', applyFilters);

        // åˆæœŸè¡¨ç¤º
        renderRaces();
        updateSelectionSummary();
    </script>
</body>
</html>
