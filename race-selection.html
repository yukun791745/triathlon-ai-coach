<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>A„É¨„Éº„ÇπÈÅ∏Êäû - Triathlon AI Coach</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #ff6b6b, #ffd93d, #6bcf7f);
            padding: 30px;
            text-align: center;
            color: white;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .controls {
            padding: 30px;
            background: #f8f9fa;
            border-bottom: 1px solid #e9ecef;
        }

        .filter-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
        }

        .filter-group label {
            font-weight: 600;
            margin-bottom: 8px;
            color: #495057;
        }

        .filter-group select, .filter-group input {
            padding: 12px;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .filter-group select:focus, .filter-group input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .search-bar {
            position: relative;
        }

        .search-bar input {
            width: 100%;
            padding-left: 45px;
        }

        .search-bar::before {
            content: "üîç";
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 1.2rem;
        }

        .stats {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 5px;
        }

        .stats-info {
            color: #6c757d;
            font-size: 0.9rem;
        }

        .view-toggle {
            display: flex;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .view-toggle button {
            padding: 8px 16px;
            border: none;
            background: white;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .view-toggle button.active {
            background: #667eea;
            color: white;
        }

        .race-list {
            padding: 30px;
        }

        .race-card {
            background: white;
            border: 2px solid #e9ecef;
            border-radius: 15px;
            margin-bottom: 20px;
            overflow: hidden;
            transition: all 0.3s ease;
            position: relative;
        }

        .race-card:hover {
            border-color: #667eea;
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
        }

        .race-card.a-race {
            border-color: #dc3545;
            border-width: 3px;
            background: linear-gradient(135deg, #fff5f5, #ffffff);
            box-shadow: 0 4px 15px rgba(220, 53, 69, 0.2);
        }

        .race-card.other-race {
            border-color: #28a745;
            border-width: 3px;
            background: linear-gradient(135deg, #f8fff9, #ffffff);
            box-shadow: 0 4px 15px rgba(40, 167, 69, 0.2);
        }



        .race-header {
            padding: 20px;
            border-bottom: 1px solid #e9ecef;
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            position: relative;
        }

        .race-title {
            flex: 1;
            padding-right: 20px;
        }

        .race-title h3 {
            font-size: 1.3rem;
            color: #212529;
            margin-bottom: 5px;
        }

        .race-subtitle {
            color: #6c757d;
            font-size: 0.9rem;
        }

        .race-actions {
            display: flex;
            flex-direction: column;
            gap: 10px;
            align-items: flex-end;
        }

        .website-link {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 8px 16px;
            background: #667eea;
            color: white;
            text-decoration: none;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .website-link:hover {
            background: #5a67d8;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }

        .race-selection-buttons {
            display: flex;
            gap: 8px;
        }

        .priority-button {
            padding: 8px 16px;
            border: 2px solid;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .priority-button.a-race-btn {
            border-color: #dc3545;
            color: #dc3545;
            background: white;
        }

        .priority-button.a-race-btn.selected {
            background: #dc3545;
            color: white;
        }

        .priority-button.other-race-btn {
            border-color: #28a745;
            color: #28a745;
            background: white;
        }

        .priority-button.other-race-btn.selected {
            background: #28a745;
            color: white;
        }

        .priority-button:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        .race-category {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .category-sprint {
            background: #e3f2fd;
            color: #1565c0;
        }

        .category-od {
            background: #f3e5f5;
            color: #7b1fa2;
        }

        .category-middle {
            background: #fff3e0;
            color: #ef6c00;
        }

        .category-long {
            background: #ffebee;
            color: #c62828;
        }

        .race-details {
            padding: 20px;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .detail-item {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .detail-icon {
            font-size: 1.2rem;
        }

        .detail-text {
            font-size: 0.9rem;
        }

        .detail-label {
            font-weight: 600;
            color: #495057;
        }

        .detail-value {
            color: #6c757d;
        }

        .status-badge {
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .status-entry {
            background: #d4edda;
            color: #155724;
        }

        .status-scheduled {
            background: #cce5ff;
            color: #004085;
        }

        .selection-actions {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            padding: 20px;
            min-width: 300px;
            display: none;
        }

        .selection-actions.show {
            display: block;
            animation: slideUp 0.3s ease;
        }

        .selection-summary {
            margin-bottom: 15px;
        }

        .selection-summary h4 {
            color: #495057;
            margin-bottom: 10px;
        }

        .summary-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 5px 0;
            font-size: 0.9rem;
        }

        .summary-label {
            font-weight: 600;
        }

        .summary-count {
            background: #e9ecef;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 0.8rem;
        }

        .action-buttons {
            display: flex;
            gap: 10px;
        }

        .action-button {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .primary-button {
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
        }

        .secondary-button {
            background: #f8f9fa;
            color: #495057;
            border: 1px solid #dee2e6;
        }

        .action-button:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #6c757d;
        }

        .empty-state-icon {
            font-size: 4rem;
            margin-bottom: 20px;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 2rem;
            }
            
            .filter-section {
                grid-template-columns: 1fr;
            }
            
            .race-details {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üèä‚Äç‚ôÇÔ∏èüö¥‚Äç‚ôÇÔ∏èüèÉ‚Äç‚ôÇÔ∏è „É¨„Éº„ÇπÈÅ∏Êäû„ÉªÁÆ°ÁêÜ</h1>
            <p>ÂèÇÂä†‰∫àÂÆö„ÅÆÂ§ß‰ºö„ÇíÈÅ∏Êäû„ÉªÁÆ°ÁêÜ„Åß„Åç„Çã„ÉØ„É≥„Çπ„Éà„ÉÉ„Éó„Ç∑„Éß„ÉÉ„Éó</p>
        </div>

        <div class="controls">
            <div class="filter-section">
                <div class="filter-group">
                    <label for="categoryFilter">„Ç´„ÉÜ„Ç¥„É™„Éº</label>
                    <select id="categoryFilter">
                        <option value="">„Åô„Åπ„Å¶</option>
                        <option value="Sprint">„Çπ„Éó„É™„É≥„Éà</option>
                        <option value="OD">„Ç™„É™„É≥„Éî„ÉÉ„ÇØ„Éá„Ç£„Çπ„Çø„É≥„Çπ</option>
                        <option value="Middle">„Éü„Éâ„É´</option>
                        <option value="Long">„É≠„É≥„Ç∞</option>
                    </select>
                </div>
                
                <div class="filter-group">
                    <label for="prefectureFilter">ÈñãÂÇ¨Âú∞</label>
                    <select id="prefectureFilter">
                        <option value="">„Åô„Åπ„Å¶</option>
                        <option value="Êù±‰∫¨ÈÉΩ">Êù±‰∫¨ÈÉΩ</option>
                        <option value="Á•ûÂ•àÂ∑ùÁúå">Á•ûÂ•àÂ∑ùÁúå</option>
                        <option value="ÊÑõÁü•Áúå">ÊÑõÁü•Áúå</option>
                        <option value="Ê≤ñÁ∏ÑÁúå">Ê≤ñÁ∏ÑÁúå</option>
                        <option value="Êñ∞ÊΩüÁúå">Êñ∞ÊΩüÁúå</option>
                        <option value="Â§ßÈò™Â∫ú">Â§ßÈò™Â∫ú</option>
                        <option value="ÂÆÆÂüéÁúå">ÂÆÆÂüéÁúå</option>
                    </select>
                </div>
                
                <div class="filter-group">
                    <label for="monthFilter">ÈñãÂÇ¨Êúà</label>
                    <select id="monthFilter">
                        <option value="">„Åô„Åπ„Å¶</option>
                        <option value="04">4Êúà</option>
                        <option value="05">5Êúà</option>
                        <option value="06">6Êúà</option>
                        <option value="07">7Êúà</option>
                        <option value="08">8Êúà</option>
                        <option value="09">9Êúà</option>
                        <option value="10">10Êúà</option>
                    </select>
                </div>
                
                <div class="filter-group search-bar">
                    <label for="searchInput">Â§ß‰ºöÂêçÊ§úÁ¥¢</label>
                    <input type="text" id="searchInput" placeholder="Â§ß‰ºöÂêç„ÇíÂÖ•Âäõ...">
                </div>
            </div>
            
            <div class="stats">
                <div class="stats-info">
                    <span id="raceCount">0</span> ‰ª∂„ÅÆÂ§ß‰ºö„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åó„Åü
                </div>
                <div class="view-toggle">
                    <button class="active" onclick="setView('card', this)">„Ç´„Éº„ÉâË°®Á§∫</button>
                    <button onclick="setView('list', this)">„É™„Çπ„ÉàË°®Á§∫</button>
                </div>
            </div>
        </div>

        <div class="race-list" id="raceList">
            <!-- Â§ß‰ºö„Ç´„Éº„Éâ„Åå„Åì„Åì„Å´ÂãïÁöÑ„Å´ÁîüÊàê„Åï„Çå„Åæ„Åô -->
        </div>
    </div>

    <div class="selection-actions" id="selectionActions">
        <div class="selection-summary">
            <h4>ÈÅ∏Êäû‰∏≠„ÅÆ„É¨„Éº„Çπ</h4>
            <div class="summary-item">
                <span class="summary-label">A„É¨„Éº„Çπ:</span>
                <span class="summary-count" id="aRaceCount">0</span>
            </div>
            <div class="summary-item">
                <span class="summary-label">„Åù„ÅÆ‰ªñ„ÅÆ„É¨„Éº„Çπ:</span>
                <span class="summary-count" id="otherRaceCount">0</span>
            </div>
        </div>
        <div class="action-buttons">
            <button class="action-button secondary-button" onclick="clearAllSelections()">
                „ÇØ„É™„Ç¢
            </button>
            <button class="action-button primary-button" onclick="proceedToGoalSetting()">
                ÁõÆÊ®ôË®≠ÂÆö„Å∏
            </button>
        </div>
    </div>

    <script>
        // „Çµ„É≥„Éó„É´„Éá„Éº„Çø
        const raceData = [
            {
                'id': 'tokyo-bay-tri-2025',
                'name': 'Êù±‰∫¨„Éô„Ç§„Éà„É©„Ç§„Ç¢„Çπ„É≠„É≥',
                'date': '2025-06-15',
                'category': 'OD',
                'location': {
                    'prefecture': 'Êù±‰∫¨ÈÉΩ',
                    'city': 'Ê±üÊù±Âå∫',
                    'venue': '„ÅäÂè∞Â†¥Êµ∑ÊµúÂÖ¨Âúí',
                    'full_text': 'Êù±‰∫¨ÈÉΩÊ±üÊù±Âå∫„ÅäÂè∞Â†¥Êµ∑ÊµúÂÖ¨Âúí'
                },
                'entry_period': '2025Âπ¥3Êúà1Êó•„Äú5Êúà31Êó•',
                'source': 'JTU',
                'url': 'https://www.jtu.or.jp/event/example1',
                'status': '„Ç®„É≥„Éà„É™„Éº‰∏≠'
            },
            {
                'id': 'shonan-tri-2025',
                'name': 'ÊπòÂçó„Éà„É©„Ç§„Ç¢„Çπ„É≠„É≥',
                'date': '2025-07-20',
                'category': 'Sprint',
                'location': {
                    'prefecture': 'Á•ûÂ•àÂ∑ùÁúå',
                    'city': 'Ëó§Ê≤¢Â∏Ç',
                    'venue': 'ÁâáÁÄ¨Êµ∑Â≤∏',
                    'full_text': 'Á•ûÂ•àÂ∑ùÁúåËó§Ê≤¢Â∏ÇÁâáÁÄ¨Êµ∑Â≤∏'
                },
                'entry_period': '2025Âπ¥4Êúà1Êó•„Äú6Êúà30Êó•',
                'source': 'JTU',
                'url': 'https://www.jtu.or.jp/event/example2',
                'status': 'ÈñãÂÇ¨‰∫àÂÆö'
            },
            {
                'id': 'yokohama-wts-2025',
                'name': '2025„ÉØ„Éº„É´„Éâ„Éà„É©„Ç§„Ç¢„Çπ„É≠„É≥„ÉÅ„É£„É≥„Éî„Ç™„É≥„Ç∑„ÉÉ„Éó„Ç∑„É™„Éº„Ç∫Ê®™ÊµúÂ§ß‰ºö',
                'date': '2025-05-17',
                'category': 'OD',
                'location': {
                    'prefecture': 'Á•ûÂ•àÂ∑ùÁúå',
                    'city': 'Ê®™ÊµúÂ∏Ç',
                    'venue': 'Â±±‰∏ãÂÖ¨ÂúíÂë®Ëæ∫',
                    'full_text': 'Á•ûÂ•àÂ∑ùÁúåÊ®™ÊµúÂ∏ÇÂ±±‰∏ãÂÖ¨ÂúíÂë®Ëæ∫'
                },
                'entry_period': '2024Âπ¥10Êúà10Êó•„Äú2025Âπ¥3Êúà31Êó•',
                'source': 'JTU',
                'url': 'https://www.jtu.or.jp/event/yokohama2025',
                'status': '„Ç®„É≥„Éà„É™„Éº‰∏≠'
            },
            {
                'id': 'gamagori-tri-2025',
                'name': 'Ëí≤ÈÉ°„Éà„É©„Ç§„Ç¢„Çπ„É≠„É≥ÂÖ®Êó•Êú¨ÈÅ∏ÊâãÊ®©',
                'date': '2025-06-08',
                'category': 'OD',
                'location': {
                    'prefecture': 'ÊÑõÁü•Áúå',
                    'city': 'Ëí≤ÈÉ°Â∏Ç',
                    'venue': 'Ëí≤ÈÉ°Êµ∑Â≤∏',
                    'full_text': 'ÊÑõÁü•ÁúåËí≤ÈÉ°Â∏ÇËí≤ÈÉ°Êµ∑Â≤∏'
                },
                'entry_period': '2025Âπ¥2Êúà1Êó•„Äú4Êúà30Êó•',
                'source': 'JTU',
                'url': 'https://www.jtu.or.jp/event/gamagori2025',
                'status': 'ÈñãÂÇ¨‰∫àÂÆö'
            },
            {
                'id': 'miyakojima-tri-2025',
                'name': 'ÂÆÆÂè§Â≥∂„Éà„É©„Ç§„Ç¢„Çπ„É≠„É≥',
                'date': '2025-04-20',
                'category': 'Long',
                'location': {
                    'prefecture': 'Ê≤ñÁ∏ÑÁúå',
                    'city': 'ÂÆÆÂè§Â≥∂Â∏Ç',
                    'venue': '‰∏ãÂú∞Â≥∂Á©∫Ê∏ØÂë®Ëæ∫',
                    'full_text': 'Ê≤ñÁ∏ÑÁúåÂÆÆÂè§Â≥∂Â∏Ç‰∏ãÂú∞Â≥∂Á©∫Ê∏ØÂë®Ëæ∫'
                },
                'entry_period': '2024Âπ¥12Êúà1Êó•„Äú2025Âπ¥2Êúà28Êó•',
                'source': 'JTU',
                'url': 'https://www.jtu.or.jp/event/miyakojima2025',
                'status': 'ÈñãÂÇ¨‰∫àÂÆö'
            },
            {
                'id': 'sado-tri-2025',
                'name': '‰ΩêÊ∏°ÂõΩÈöõ„Éà„É©„Ç§„Ç¢„Çπ„É≠„É≥',
                'date': '2025-09-07',
                'category': 'Long',
                'location': {
                    'prefecture': 'Êñ∞ÊΩüÁúå',
                    'city': '‰ΩêÊ∏°Â∏Ç',
                    'venue': '‰ΩêÊ∏°Â≥∂',
                    'full_text': 'Êñ∞ÊΩüÁúå‰ΩêÊ∏°Â∏Ç‰ΩêÊ∏°Â≥∂'
                },
                'entry_period': '2025Âπ¥3Êúà1Êó•„Äú6Êúà30Êó•',
                'source': 'JTU',
                'url': 'https://www.jtu.or.jp/event/sado2025',
                'status': 'ÈñãÂÇ¨‰∫àÂÆö'
            },
            {
                'id': 'ishigaki-tri-2025',
                'name': 'Áü≥Âû£Â≥∂„Éà„É©„Ç§„Ç¢„Çπ„É≠„É≥',
                'date': '2025-04-13',
                'category': 'OD',
                'location': {
                    'prefecture': 'Ê≤ñÁ∏ÑÁúå',
                    'city': 'Áü≥Âû£Â∏Ç',
                    'venue': 'Áü≥Âû£Â≥∂',
                    'full_text': 'Ê≤ñÁ∏ÑÁúåÁü≥Âû£Â∏ÇÁü≥Âû£Â≥∂'
                },
                'entry_period': '2024Âπ¥12Êúà1Êó•„Äú3Êúà15Êó•',
                'source': 'JTU',
                'url': 'https://www.jtu.or.jp/event/ishigaki2025',
                'status': '„Ç®„É≥„Éà„É™„Éº‰∏≠'
            },
            {
                'id': 'tokyo-sprint-2025',
                'name': 'Êù±‰∫¨„Çπ„Éó„É™„É≥„Éà„Éà„É©„Ç§„Ç¢„Çπ„É≠„É≥',
                'date': '2025-05-25',
                'category': 'Sprint',
                'location': {
                    'prefecture': 'Êù±‰∫¨ÈÉΩ',
                    'city': 'Ê±üÊù±Âå∫',
                    'venue': '„ÅäÂè∞Â†¥Êµ∑ÊµúÂÖ¨Âúí',
                    'full_text': 'Êù±‰∫¨ÈÉΩÊ±üÊù±Âå∫„ÅäÂè∞Â†¥Êµ∑ÊµúÂÖ¨Âúí'
                },
                'entry_period': '2025Âπ¥2Êúà1Êó•„Äú4Êúà30Êó•',
                'source': 'JTU',
                'url': 'https://www.jtu.or.jp/event/tokyosprint2025',
                'status': 'ÈñãÂÇ¨‰∫àÂÆö'
            },
            {
                'id': 'osaka-tri-2025',
                'name': 'Â§ßÈò™„Éà„É©„Ç§„Ç¢„Çπ„É≠„É≥ËàûÊ¥≤',
                'date': '2025-10-12',
                'category': 'OD',
                'location': {
                    'prefecture': 'Â§ßÈò™Â∫ú',
                    'city': 'Â§ßÈò™Â∏Ç',
                    'venue': 'ËàûÊ¥≤',
                    'full_text': 'Â§ßÈò™Â∫úÂ§ßÈò™Â∏ÇËàûÊ¥≤'
                },
                'entry_period': '2025Âπ¥6Êúà1Êó•„Äú9Êúà15Êó•',
                'source': 'JTU',
                'url': 'https://www.jtu.or.jp/event/osaka2025',
                'status': '„Ç®„É≥„Éà„É™„Éº‰∏≠'
            },
            {
                'id': 'tohoku-tri-2025',
                'name': 'Êù±Âåó„Éà„É©„Ç§„Ç¢„Çπ„É≠„É≥ÈÅ∏ÊâãÊ®©',
                'date': '2025-08-17',
                'category': 'Middle',
                'location': {
                    'prefecture': 'ÂÆÆÂüéÁúå',
                    'city': '‰∏É„É∂ÊµúÁî∫',
                    'venue': '‰∏É„É∂ÊµúÊµ∑Â≤∏',
                    'full_text': 'ÂÆÆÂüéÁúå‰∏É„É∂ÊµúÁî∫‰∏É„É∂ÊµúÊµ∑Â≤∏'
                },
                'entry_period': '2025Âπ¥5Êúà1Êó•„Äú7Êúà31Êó•',
                'source': 'JTU',
                'url': 'https://www.jtu.or.jp/event/tohoku2025',
                'status': 'ÈñãÂÇ¨‰∫àÂÆö'
            }
        ];

        let filteredRaces = [...raceData];
        let selectedRaces = {
            aRace: null,
            otherRaces: []
        };
        let currentView = 'card';

        // „É¨„Éº„ÇπÂÑ™ÂÖàÂ∫¶Ë®≠ÂÆöÔºà„Éà„Ç∞„É´Ê©üËÉΩ‰ªò„ÅçÔºâ
        function setRacePriority(raceId, priority) {
            const race = raceData.find(r => r.id === raceId);
            if (!race) return;

            if (priority === 'a-race') {
                // Êó¢„Å´A„É¨„Éº„Çπ„Å´Ë®≠ÂÆö„Åï„Çå„Å¶„ÅÑ„ÇãÂ†¥Âêà„ÅØËß£Èô§
                if (selectedRaces.aRace?.id === raceId) {
                    selectedRaces.aRace = null;
                } else {
                    // A„É¨„Éº„Çπ„ÅØ1„Å§„ÅÆ„Åø
                    selectedRaces.aRace = race;
                    // „ÇÇ„ÅóÊó¢„Å´„Åù„ÅÆ‰ªñ„ÅÆ„É¨„Éº„Çπ„Å´ÂÖ•„Å£„Å¶„ÅÑ„Åü„ÇâÂâäÈô§
                    selectedRaces.otherRaces = selectedRaces.otherRaces.filter(r => r.id !== raceId);
                }
            } else if (priority === 'other-race') {
                // Êó¢„Å´„Åù„ÅÆ‰ªñ„ÅÆ„É¨„Éº„Çπ„Å´ÂÖ•„Å£„Å¶„ÅÑ„ÇãÂ†¥Âêà„ÅØÂâäÈô§
                if (selectedRaces.otherRaces.some(r => r.id === raceId)) {
                    selectedRaces.otherRaces = selectedRaces.otherRaces.filter(r => r.id !== raceId);
                } else {
                    // „Åù„ÅÆ‰ªñ„ÅÆ„É¨„Éº„Çπ„Å´ËøΩÂä†
                    selectedRaces.otherRaces.push(race);
                    // „ÇÇ„ÅóA„É¨„Éº„Çπ„Å†„Å£„Åü„ÇâÂâäÈô§
                    if (selectedRaces.aRace?.id === raceId) {
                        selectedRaces.aRace = null;
                    }
                }
            }

            updateSelectionSummary();
            renderRaces();
        }

        // ÈÅ∏ÊäûËß£Èô§
        function removeRaceSelection(raceId) {
            if (selectedRaces.aRace?.id === raceId) {
                selectedRaces.aRace = null;
            }
            selectedRaces.otherRaces = selectedRaces.otherRaces.filter(r => r.id !== raceId);
            
            updateSelectionSummary();
            renderRaces();
        }

        // ÈÅ∏Êäû„Çµ„Éû„É™„ÉºÊõ¥Êñ∞
        function updateSelectionSummary() {
            const totalSelected = (selectedRaces.aRace ? 1 : 0) + selectedRaces.otherRaces.length;
            console.log(`ÈÅ∏Êäû‰∏≠: A„É¨„Éº„Çπ ${selectedRaces.aRace ? 1 : 0}‰ª∂, „Åù„ÅÆ‰ªñ ${selectedRaces.otherRaces.length}‰ª∂`);
        }

        // „É¨„Éº„Çπ„Ç´„Éº„Éâ„ÅÆ„ÇØ„É©„ÇπÂèñÂæó
        function getSelectedRaceClass(raceId) {
            if (selectedRaces.aRace?.id === raceId) {
                return 'a-race';
            } else if (selectedRaces.otherRaces.some(r => r.id === raceId)) {
                return 'other-race';
            }
            return '';
        }

        // „É¨„Éº„ÇπÂÑ™ÂÖàÂ∫¶„Éê„ÉÉ„Ç∏ÂèñÂæóÔºàÂâäÈô§Ê∏à„ÅøÔºâ
        function getSelectedRaceBadge(raceId) {
            return ''; // „Éê„ÉÉ„Ç∏„ÅØÊû†Á∑ö„Åß‰ª£Êõø
        }

        // „Éï„Ç£„É´„Çø„Éº„ÉªÊ§úÁ¥¢Ê©üËÉΩ
        function applyFilters() {
            const categoryFilter = document.getElementById('categoryFilter').value;
            const prefectureFilter = document.getElementById('prefectureFilter').value;
            const monthFilter = document.getElementById('monthFilter').value;
            const searchQuery = document.getElementById('searchInput').value.toLowerCase();

            filteredRaces = raceData.filter(race => {
                const matchesCategory = !categoryFilter || race.category === categoryFilter;
                const matchesPrefecture = !prefectureFilter || race.location.prefecture === prefectureFilter;
                const matchesMonth = !monthFilter || race.date.substring(5, 7) === monthFilter;
                const matchesSearch = !searchQuery || race.name.toLowerCase().includes(searchQuery);
                
                return matchesCategory && matchesPrefecture && matchesMonth && matchesSearch;
            });

            renderRaces();
        }

        // Â§ß‰ºö„Ç´„Éº„Éâ/„É™„Çπ„Éà„ÅÆË°®Á§∫
        function renderRaces() {
            const raceList = document.getElementById('raceList');
            const raceCount = document.getElementById('raceCount');
            
            raceCount.textContent = filteredRaces.length;

            if (filteredRaces.length === 0) {
                raceList.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üîç</div>
                        <h3>Ë©≤ÂΩì„Åô„ÇãÂ§ß‰ºö„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì„Åß„Åó„Åü</h3>
                        <p>„Éï„Ç£„É´„Çø„ÉºÊù°‰ª∂„ÇíÂ§âÊõ¥„Åó„Å¶„ÅäË©¶„Åó„Åè„Å†„Åï„ÅÑ</p>
                    </div>
                `;
                return;
            }

            raceList.innerHTML = filteredRaces.map(race => `
                <div class="race-card ${getSelectedRaceClass(race.id)}" id="race-${race.id}">
                    <div class="race-header">
                        <div class="race-title">
                            <h3>${race.name}</h3>
                            <div class="race-subtitle">${formatDate(race.date)} ÈñãÂÇ¨</div>
                        </div>
                        <div class="race-actions">
                            <a href="${race.url}" target="_blank" class="website-link">
                                Â§ß‰ºö„Çµ„Ç§„Éà üîó
                            </a>
                            <div class="race-category category-${race.category.toLowerCase()}">
                                ${getCategoryLabel(race.category)}
                            </div>
                            <div class="race-selection-buttons">
                                <button class="priority-button a-race-btn ${selectedRaces.aRace?.id === race.id ? 'selected' : ''}" 
                                        onclick="setRacePriority('${race.id}', 'a-race')">
                                    A„É¨„Éº„Çπ
                                </button>
                                <button class="priority-button other-race-btn ${selectedRaces.otherRaces.some(r => r.id === race.id) ? 'selected' : ''}" 
                                        onclick="setRacePriority('${race.id}', 'other-race')">
                                    „Åù„ÅÆ‰ªñ
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="race-details">
                        <div class="detail-item">
                            <div class="detail-icon">üìÖ</div>
                            <div class="detail-text">
                                <div class="detail-label">ÈñãÂÇ¨Êó•</div>
                                <div class="detail-value">${formatDate(race.date)}</div>
                            </div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-icon">üìç</div>
                            <div class="detail-text">
                                <div class="detail-label">ÈñãÂÇ¨Âú∞</div>
                                <div class="detail-value">${race.location.full_text}</div>
                            </div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-icon">üìù</div>
                            <div class="detail-text">
                                <div class="detail-label">„Ç®„É≥„Éà„É™„ÉºÊúüÈñì</div>
                                <div class="detail-value">${race.entry_period}</div>
                            </div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-icon">üè∑Ô∏è</div>
                            <div class="detail-text">
                                <div class="detail-label">„Çπ„ÉÜ„Éº„Çø„Çπ</div>
                                <div class="detail-value">
                                    <span class="status-badge ${race.status === '„Ç®„É≥„Éà„É™„Éº‰∏≠' ? 'status-entry' : 'status-scheduled'}">
                                        ${race.status}
                                    </span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // „É¨„Éº„ÇπÈÅ∏ÊäûÁä∂ÊÖã„ÅÆÊõ¥Êñ∞
        function updateSelectionSummary() {
            const aRaceCount = selectedRaces.aRace ? 1 : 0;
            const otherRaceCount = selectedRaces.otherRaces.length;
            const totalSelected = aRaceCount + otherRaceCount;
            
            // „Çµ„Éû„É™„ÉºË°®Á§∫„ÅÆÊõ¥Êñ∞
            document.getElementById('aRaceCount').textContent = aRaceCount;
            document.getElementById('otherRaceCount').textContent = otherRaceCount;
            
            // ÈÅ∏Êäû„Ç¢„ÇØ„Ç∑„Éß„É≥„Éë„Éç„É´„ÅÆË°®Á§∫/ÈùûË°®Á§∫
            const selectionActions = document.getElementById('selectionActions');
            if (totalSelected > 0) {
                selectionActions.classList.add('show');
            } else {
                selectionActions.classList.remove('show');
            }
        }

        // ÂÖ®ÈÅ∏Êäû„ÇØ„É™„Ç¢
        function clearAllSelections() {
            selectedRaces.aRace = null;
            selectedRaces.otherRaces = [];
            updateSelectionSummary();
            renderRaces();
        }

        // ÁõÆÊ®ôË®≠ÂÆö„Å∏ÈÄ≤„ÇÄ
        function proceedToGoalSetting() {
            const totalSelected = (selectedRaces.aRace ? 1 : 0) + selectedRaces.otherRaces.length;
            
            if (totalSelected === 0) {
                alert('ÂèÇÂä†‰∫àÂÆö„ÅÆ„É¨„Éº„Çπ„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ');
                return;
            }
            
            if (!selectedRaces.aRace) {
                const confirm = window.confirm('A„É¨„Éº„Çπ„ÅåË®≠ÂÆö„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì„ÄÇ\n\nA„É¨„Éº„Çπ„ÅØÊúÄ„ÇÇÈáçË¶Å„Å™ÁõÆÊ®ô„É¨„Éº„Çπ„Åß„Åô„ÄÇ\n„Äå„Åù„ÅÆ‰ªñ„ÅÆ„É¨„Éº„Çπ„Äç„Åã„Çâ1„Å§„ÇíA„É¨„Éº„Çπ„Å´Â§âÊõ¥„Åó„Åæ„Åô„ÅãÔºü');
                if (!confirm) return;
            }
            
            console.log('Selected races:', selectedRaces);
            alert(`„É¨„Éº„ÇπÈÅ∏ÊäûÂÆå‰∫ÜÔºÅ\n\nA„É¨„Éº„Çπ: ${selectedRaces.aRace ? selectedRaces.aRace.name : '„Å™„Åó'}\n„Åù„ÅÆ‰ªñ„ÅÆ„É¨„Éº„Çπ: ${selectedRaces.otherRaces.length}‰ª∂\n\nÊ¨°„ÅÆ„Çπ„ÉÜ„ÉÉ„ÉóÔºöÁõÆÊ®ô„Çø„Ç§„É†Ë®≠ÂÆö„Å´ÈÄ≤„Åø„Åæ„Åô„ÄÇ`);
            
            // ÂÆüÈöõ„ÅÆ„Ç¢„Éó„É™„Åß„ÅØ„ÄÅ„Åì„Åì„Åß„Éá„Éº„Çø„Çí‰øùÂ≠ò„Åó„ÄÅÊ¨°„ÅÆÁîªÈù¢„Å´ÈÅ∑Áßª
        }

        // „Éì„É•„ÉºÂàá„ÇäÊõø„Åà
        function setView(view, buttonElement) {
            currentView = view;
            document.querySelectorAll('.view-toggle button').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // „ÇØ„É™„ÉÉ„ÇØ„Åï„Çå„Åü„Éú„Çø„É≥„Çí„Ç¢„ÇØ„ÉÜ„Ç£„Éñ„Å´„Åô„Çã
            buttonElement.classList.add('active');
            
            // „Éì„É•„ÉºÂàá„ÇäÊõø„Åà„ÅÆ„É≠„Ç∏„ÉÉ„ÇØÔºàÁèæÂú®„ÅØ„Ç´„Éº„ÉâË°®Á§∫„ÅÆ„ÅøÂÆüË£ÖÔºâ
            if (view === 'list') {
                // „É™„Çπ„ÉàË°®Á§∫„ÅÆÂÆüË£ÖÔºàÂ∞ÜÊù•ÁöÑ„Å´Ôºâ
                console.log('„É™„Çπ„ÉàË°®Á§∫„Å´Âàá„ÇäÊõø„Åà');
                alert('„É™„Çπ„ÉàË°®Á§∫Ê©üËÉΩ„ÅØ‰ªäÂæåÂÆüË£Ö‰∫àÂÆö„Åß„Åô');
            } else {
                // „Ç´„Éº„ÉâË°®Á§∫ÔºàÁèæÂú®„ÅÆË°®Á§∫Ôºâ
                console.log('„Ç´„Éº„ÉâË°®Á§∫„Å´Âàá„ÇäÊõø„Åà');
            }
        }

        // „É¶„Éº„ÉÜ„Ç£„É™„ÉÜ„Ç£Èñ¢Êï∞
        function formatDate(dateString) {
            const date = new Date(dateString);
            return `${date.getFullYear()}Âπ¥${date.getMonth() + 1}Êúà${date.getDate()}Êó•`;
        }

        function getCategoryLabel(category) {
            const labels = {
                'Sprint': '„Çπ„Éó„É™„É≥„Éà',
                'OD': '„Ç™„É™„É≥„Éî„ÉÉ„ÇØ',
                'Middle': '„Éü„Éâ„É´',
                'Long': '„É≠„É≥„Ç∞'
            };
            return labels[category] || category;
        }

        // „Ç§„Éô„É≥„Éà„É™„Çπ„Éä„Éº
        document.getElementById('categoryFilter').addEventListener('change', applyFilters);
        document.getElementById('prefectureFilter').addEventListener('change', applyFilters);
        document.getElementById('monthFilter').addEventListener('change', applyFilters);
        document.getElementById('searchInput').addEventListener('input', applyFilters);

        // ÂàùÊúüË°®Á§∫
        renderRaces();
        updateSelectionSummary();
    </script>
</body>
</html>
