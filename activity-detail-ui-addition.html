<!-- ============================================
     activity-detail.html ã«è¿½åŠ ã™ã‚‹ã‚³ãƒ¼ãƒ‰
     AIã‚³ãƒ¼ãƒã‚³ãƒ¡ãƒ³ãƒˆã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’ç½®ãæ›ãˆ
     ============================================ -->

<!-- ===== CSSï¼ˆ<style>ã‚¿ã‚°å†…ã«è¿½åŠ ï¼‰ ===== -->
<style>
/* ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚¿ã‚¤ãƒ—é¸æŠUI */
.session-type-selector {
    background: #f8fafc;
    border-radius: 12px;
    padding: 20px;
    margin-bottom: 16px;
}

.session-type-header {
    margin-bottom: 16px;
}

.session-type-title {
    font-size: 1.1rem;
    font-weight: 700;
    color: #1f2937;
    margin-bottom: 4px;
}

.session-type-subtitle {
    font-size: 0.9rem;
    color: #6b7280;
}

.session-type-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
    gap: 10px;
    margin-bottom: 16px;
}

.session-type-btn {
    background: white;
    border: 2px solid #e5e7eb;
    border-radius: 10px;
    padding: 12px 14px;
    text-align: left;
    cursor: pointer;
    transition: all 0.2s ease;
}

.session-type-btn:hover {
    border-color: #667eea;
    background: #f5f3ff;
}

.session-type-btn.selected {
    border-color: #667eea;
    background: #ede9fe;
}

.session-type-btn-label {
    font-size: 0.9rem;
    font-weight: 600;
    color: #1f2937;
    display: block;
}

.session-type-btn-desc {
    font-size: 0.75rem;
    color: #6b7280;
    margin-top: 2px;
}

.session-supplement {
    margin-top: 12px;
}

.session-supplement-label {
    font-size: 0.85rem;
    font-weight: 600;
    color: #4b5563;
    margin-bottom: 6px;
    display: block;
}

.session-supplement-input {
    width: 100%;
    padding: 10px 12px;
    border: 1px solid #d1d5db;
    border-radius: 8px;
    font-size: 0.9rem;
    resize: none;
}

.session-supplement-input:focus {
    outline: none;
    border-color: #667eea;
    box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
}

.generate-comment-btn {
    width: 100%;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    border: none;
    border-radius: 10px;
    padding: 14px 20px;
    font-size: 1rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s ease;
    margin-top: 16px;
}

.generate-comment-btn:hover:not(:disabled) {
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
}

.generate-comment-btn:disabled {
    background: #9ca3af;
    cursor: not-allowed;
}

/* ãã®ä»–é¸æŠæ™‚ã®å…¥åŠ›æ¬„ */
.other-input-container {
    display: none;
    margin-top: 12px;
}

.other-input-container.visible {
    display: block;
}

.other-input {
    width: 100%;
    padding: 10px 12px;
    border: 1px solid #d1d5db;
    border-radius: 8px;
    font-size: 0.9rem;
}

/* AIã‚³ãƒ¡ãƒ³ãƒˆè¡¨ç¤ºã‚¨ãƒªã‚¢ */
.ai-comment-result {
    display: none;
    background: white;
    border-radius: 12px;
    padding: 20px;
    margin-top: 16px;
    border-left: 4px solid #667eea;
}

.ai-comment-result.visible {
    display: block;
}

.ai-comment-result-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 12px;
}

.ai-comment-result-title {
    font-weight: 700;
    color: #1f2937;
}

.ai-comment-result-type {
    font-size: 0.8rem;
    background: #ede9fe;
    color: #667eea;
    padding: 4px 10px;
    border-radius: 12px;
}

.ai-comment-text {
    color: #374151;
    line-height: 1.7;
}

.regenerate-btn {
    background: #f3f4f6;
    color: #4b5563;
    border: none;
    border-radius: 8px;
    padding: 8px 16px;
    font-size: 0.85rem;
    cursor: pointer;
    margin-top: 12px;
    transition: all 0.2s;
}

.regenerate-btn:hover {
    background: #e5e7eb;
}
</style>


<!-- ===== HTMLï¼ˆAIã‚³ãƒ¼ãƒãƒ‘ãƒãƒ«éƒ¨åˆ†ã‚’ç½®ãæ›ãˆï¼‰ ===== -->
<div class="panel">
    <div class="panel-header">
        <h3 class="panel-title">ğŸ¤– AIã‚³ãƒ¼ãƒ</h3>
    </div>
    <div class="panel-body" style="padding: 20px;">
        
        <!-- ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚¿ã‚¤ãƒ—é¸æŠ -->
        <div class="session-type-selector" id="sessionTypeSelector">
            <div class="session-type-header">
                <div class="session-type-title">ğŸ¯ ä»Šæ—¥ã®ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ã®ç›®çš„ã¯ï¼Ÿ</div>
                <div class="session-type-subtitle">æ•™ãˆã¦ã„ãŸã ã‘ã‚Œã°ã€AIã‚³ãƒ¼ãƒãŒã‚ˆã‚Šçš„ç¢ºãªã‚³ãƒ¡ãƒ³ãƒˆã‚’ãŠå±Šã‘ã—ã¾ã™</div>
            </div>
            
            <div class="session-type-grid" id="sessionTypeGrid">
                <!-- JavaScriptã§å‹•çš„ã«ç”Ÿæˆ -->
            </div>
            
            <!-- ãã®ä»–é¸æŠæ™‚ã®å…¥åŠ›æ¬„ -->
            <div class="other-input-container" id="otherInputContainer">
                <input type="text" class="other-input" id="otherInput" 
                       placeholder="ä¾‹ï¼šå‰åŠã‚­ãƒƒã‚¯ç·´ç¿’ã€å¾ŒåŠãƒ—ãƒ«ãƒ–ã‚¤ã§1500m">
            </div>
            
            <!-- è£œè¶³å…¥åŠ› -->
            <div class="session-supplement">
                <label class="session-supplement-label">ğŸ’¬ è£œè¶³ï¼ˆä»»æ„ï¼‰</label>
                <textarea class="session-supplement-input" id="sessionSupplement" rows="2"
                          placeholder="ä¾‹ï¼šå¾ŒåŠãƒ“ãƒ«ãƒ‰ã‚¢ãƒƒãƒ—ã‚’æ„è­˜ã—ãŸã€æš‘ãã¦ãƒšãƒ¼ã‚¹ã‚’æŠ‘ãˆãŸã€ãªã©"></textarea>
            </div>
            
            <button class="generate-comment-btn" id="generateCommentBtn" disabled>
                AIã‚³ãƒ¼ãƒã®ã‚³ãƒ¡ãƒ³ãƒˆã‚’è¦‹ã‚‹
            </button>
        </div>
        
        <!-- ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚° -->
        <div id="aiCommentLoading" style="display: none; text-align: center; padding: 30px;">
            <div class="loading-spinner"></div>
            <p style="color: #6b7280; margin-top: 12px;">AIã‚³ãƒ¼ãƒãŒåˆ†æä¸­...</p>
        </div>
        
        <!-- ã‚³ãƒ¡ãƒ³ãƒˆçµæœ -->
        <div class="ai-comment-result" id="aiCommentResult">
            <div class="ai-comment-result-header">
                <span class="ai-comment-result-title">AIã‚³ãƒ¼ãƒã®ã‚³ãƒ¡ãƒ³ãƒˆ</span>
                <span class="ai-comment-result-type" id="commentSessionType"></span>
            </div>
            <div class="ai-comment-text" id="aiCommentText"></div>
            <button class="regenerate-btn" onclick="regenerateComment()">ğŸ”„ åˆ¥ã®è¦–ç‚¹ã§ã‚³ãƒ¡ãƒ³ãƒˆ</button>
        </div>
        
        <!-- è³ªå•å…¥åŠ›ï¼ˆã‚³ãƒ¡ãƒ³ãƒˆè¡¨ç¤ºå¾Œã«è¡¨ç¤ºï¼‰ -->
        <div id="questionSection" style="display: none; margin-top: 16px; padding-top: 16px; border-top: 1px solid #e5e7eb;">
            <div style="font-weight: 600; margin-bottom: 8px;">ğŸ’¬ è³ªå•ã™ã‚‹</div>
            <div style="display: flex; gap: 8px;">
                <input type="text" id="questionInput" placeholder="ã“ã®ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ã«ã¤ã„ã¦è³ªå•..."
                       style="flex: 1; padding: 10px 12px; border: 1px solid #d1d5db; border-radius: 8px;">
                <button id="askBtn" onclick="askQuestion()" 
                        style="background: #667eea; color: white; border: none; border-radius: 8px; padding: 10px 16px; cursor: pointer;">
                    è³ªå•ã™ã‚‹
                </button>
            </div>
            <div id="chatHistory" style="display: none; margin-top: 16px; max-height: 300px; overflow-y: auto;"></div>
        </div>
        
    </div>
</div>


<!-- ===== JavaScriptï¼ˆ<script>ã‚¿ã‚°å†…ã«è¿½åŠ ï¼‰ ===== -->
<script>
// ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚¿ã‚¤ãƒ—å®šç¾©
const SESSION_TYPES = {
    swim: [
        { id: 'swim_drill_focus', label: 'ãƒ†ã‚¯ãƒ‹ãƒƒã‚¯é‡è¦–', description: 'ãƒ‰ãƒªãƒ«ä¸­å¿ƒ' },
        { id: 'swim_drill_endurance', label: 'ãƒ‰ãƒªãƒ«ï¼‹æœ‰é…¸ç´ ', description: 'ãƒ‰ãƒªãƒ«å¾Œã«Z2' },
        { id: 'swim_drill_speed', label: 'ãƒ‰ãƒªãƒ«ï¼‹ã‚¹ãƒ”ãƒ¼ãƒ‰', description: 'ãƒ‰ãƒªãƒ«å¾Œã«é«˜å¼·åº¦' },
        { id: 'swim_endurance', label: 'æœ‰é…¸ç´ ï¼ˆæ³³ãè¾¼ã¿ï¼‰', description: 'è·é›¢é‡è¦–' },
        { id: 'swim_threshold', label: 'é–¾å€¤/CSSãƒšãƒ¼ã‚¹', description: 'ãƒ†ãƒ³ãƒã‚¹ã‚¤ãƒ ' },
        { id: 'swim_interval', label: 'é«˜å¼·åº¦ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒ«', description: 'ã‚¹ãƒ—ãƒªãƒ³ãƒˆç­‰' },
        { id: 'swim_ow', label: 'ã‚ªãƒ¼ãƒ—ãƒ³ã‚¦ã‚©ãƒ¼ã‚¿ãƒ¼', description: 'æµ·ãƒ»æ¹–' },
        { id: 'swim_recovery', label: 'ãƒªã‚«ãƒãƒªãƒ¼', description: 'è»½ãæµã™' },
        { id: 'swim_test', label: 'ãƒ†ã‚¹ãƒˆ/TT', description: 'CSSæ¸¬å®šç­‰' }
    ],
    bike: [
        { id: 'bike_endurance', label: 'æœ‰é…¸ç´ ã‚¨ãƒ³ãƒ‡ãƒ¥ãƒ©ãƒ³ã‚¹', description: 'Z2ä¸­å¿ƒ' },
        { id: 'bike_tempo', label: 'ãƒ†ãƒ³ãƒ/SST', description: 'FTP88-94%' },
        { id: 'bike_threshold', label: 'é–¾å€¤/FTPèµ°', description: 'FTPä»˜è¿‘æŒç¶š' },
        { id: 'bike_vo2max', label: 'VO2max/é«˜å¼·åº¦', description: 'é«˜å¼·åº¦ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒ«' },
        { id: 'bike_technique_interval', label: 'ãƒ†ã‚¯ãƒ‹ãƒƒã‚¯ï¼‹ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒ«', description: 'ãƒ‰ãƒªãƒ«ï¼‹é«˜å¼·åº¦' },
        { id: 'bike_zwift_workout', label: 'Zwiftãƒ¯ãƒ¼ã‚¯ã‚¢ã‚¦ãƒˆ', description: 'æ§‹é€ åŒ–ãƒ¡ãƒ‹ãƒ¥ãƒ¼' },
        { id: 'bike_hill', label: 'ãƒ’ãƒ«ã‚¯ãƒ©ã‚¤ãƒ ', description: 'ç™»å‚' },
        { id: 'bike_brick', label: 'ãƒ–ãƒªãƒƒã‚¯ï¼ˆâ†’ãƒ©ãƒ³ï¼‰', description: 'ãƒã‚¤ã‚¯å¾Œãƒ©ãƒ³' },
        { id: 'bike_recovery', label: 'ãƒªã‚«ãƒãƒªãƒ¼', description: 'è»½ãå›ã™' },
        { id: 'bike_test', label: 'ãƒ†ã‚¹ãƒˆ/TT', description: 'FTPæ¸¬å®šç­‰' }
    ],
    run: [
        { id: 'run_easy', label: 'ã‚¤ãƒ¼ã‚¸ãƒ¼/ã‚¸ãƒ§ã‚°', description: 'ä¼šè©±ãƒšãƒ¼ã‚¹' },
        { id: 'run_long', label: 'ãƒ­ãƒ³ã‚°èµ°', description: 'é•·è·é›¢' },
        { id: 'run_tempo', label: 'ãƒ†ãƒ³ãƒ/é–¾å€¤èµ°', description: 'LTãƒšãƒ¼ã‚¹' },
        { id: 'run_interval', label: 'ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒ«', description: 'é«˜å¼·åº¦åå¾©' },
        { id: 'run_fartlek', label: 'ãƒ•ã‚¡ãƒ«ãƒˆãƒ¬ã‚¯', description: 'ãƒšãƒ¼ã‚¹å¤‰åŒ–' },
        { id: 'run_hill', label: 'å‚é“ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°', description: 'å‚ãƒ€ãƒƒã‚·ãƒ¥ç­‰' },
        { id: 'run_brick', label: 'ãƒ–ãƒªãƒƒã‚¯ï¼ˆãƒã‚¤ã‚¯å¾Œï¼‰', description: 'ãƒã‚¤ã‚¯ç›´å¾Œ' },
        { id: 'run_recovery', label: 'ãƒªã‚«ãƒãƒªãƒ¼', description: 'éå¸¸ã«è»½ã' },
        { id: 'run_test', label: 'ãƒ†ã‚¹ãƒˆ/TT', description: 'ã‚¿ã‚¤ãƒ è¨ˆæ¸¬' }
    ],
    common: [
        { id: 'race', label: 'ãƒ¬ãƒ¼ã‚¹/å¤§ä¼š', description: 'æœ¬ç•ª' },
        { id: 'other', label: 'ãã®ä»–', description: 'ä¸Šè¨˜ä»¥å¤–' }
    ]
};

let selectedSessionType = null;
let conversationHistory = [];

// ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚¿ã‚¤ãƒ—é¸æŠUIã‚’åˆæœŸåŒ–
function initSessionTypeSelector() {
    const sportType = currentActivity.sport_type || currentActivity.type;
    const sportCategory = getSportCategory(sportType);
    
    // ç¨®ç›®ã«å¿œã˜ãŸé¸æŠè‚¢ã‚’å–å¾—
    let options = [];
    if (sportCategory === 'swim') {
        options = SESSION_TYPES.swim;
    } else if (sportCategory === 'bike') {
        options = SESSION_TYPES.bike;
    } else if (sportCategory === 'run') {
        options = SESSION_TYPES.run;
    }
    // å…±é€šã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’è¿½åŠ 
    options = options.concat(SESSION_TYPES.common);
    
    // ã‚°ãƒªãƒƒãƒ‰ã«ãƒœã‚¿ãƒ³ã‚’ç”Ÿæˆ
    const grid = document.getElementById('sessionTypeGrid');
    grid.innerHTML = '';
    
    options.forEach(function(opt) {
        const btn = document.createElement('button');
        btn.className = 'session-type-btn';
        btn.dataset.type = opt.id;
        btn.innerHTML = `
            <span class="session-type-btn-label">${opt.label}</span>
            <span class="session-type-btn-desc">${opt.description}</span>
        `;
        btn.addEventListener('click', function() {
            selectSessionType(opt.id, opt.label);
        });
        grid.appendChild(btn);
    });
}

// ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚¿ã‚¤ãƒ—ã‚’é¸æŠ
function selectSessionType(typeId, typeLabel) {
    // å‰ã®é¸æŠã‚’è§£é™¤
    document.querySelectorAll('.session-type-btn').forEach(function(btn) {
        btn.classList.remove('selected');
    });
    
    // æ–°ã—ã„é¸æŠã‚’ãƒãƒ¼ã‚¯
    const selectedBtn = document.querySelector(`.session-type-btn[data-type="${typeId}"]`);
    if (selectedBtn) {
        selectedBtn.classList.add('selected');
    }
    
    selectedSessionType = typeId;
    
    // ã€Œãã®ä»–ã€ã®å ´åˆã¯å…¥åŠ›æ¬„ã‚’è¡¨ç¤º
    const otherContainer = document.getElementById('otherInputContainer');
    if (typeId === 'other') {
        otherContainer.classList.add('visible');
    } else {
        otherContainer.classList.remove('visible');
    }
    
    // ãƒœã‚¿ãƒ³ã‚’æœ‰åŠ¹åŒ–
    document.getElementById('generateCommentBtn').disabled = false;
}

// ã‚³ãƒ¡ãƒ³ãƒˆç”Ÿæˆ
async function generateAIComment() {
    if (!selectedSessionType) {
        alert('ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚¿ã‚¤ãƒ—ã‚’é¸æŠã—ã¦ãã ã•ã„');
        return;
    }
    
    const supplement = document.getElementById('sessionSupplement').value.trim();
    const otherInput = document.getElementById('otherInput').value.trim();
    
    // ã€Œãã®ä»–ã€ã®å ´åˆã¯å…¥åŠ›å†…å®¹ã‚’è£œè¶³ã«è¿½åŠ 
    let finalSupplement = supplement;
    if (selectedSessionType === 'other' && otherInput) {
        finalSupplement = otherInput + (supplement ? 'ã€‚' + supplement : '');
    }
    
    // UIæ›´æ–°
    document.getElementById('sessionTypeSelector').style.display = 'none';
    document.getElementById('aiCommentLoading').style.display = 'block';
    document.getElementById('aiCommentResult').classList.remove('visible');
    
    try {
        const streamAnalysis = analyzeStreamData();
        const similarActivities = findSimilarActivities();
        
        const response = await fetch('/.netlify/functions/ai-coach-comment', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                activity: currentActivity,
                trainingStatus: trainingStatus,
                streamAnalysis: streamAnalysis,
                similarActivities: similarActivities,
                sessionType: selectedSessionType,
                sessionSupplement: finalSupplement,
                conversationHistory: []
            })
        });
        
        if (!response.ok) {
            throw new Error('ã‚³ãƒ¡ãƒ³ãƒˆç”Ÿæˆã«å¤±æ•—ã—ã¾ã—ãŸ');
        }
        
        const data = await response.json();
        
        // çµæœã‚’è¡¨ç¤º
        document.getElementById('aiCommentLoading').style.display = 'none';
        document.getElementById('aiCommentResult').classList.add('visible');
        document.getElementById('aiCommentText').innerHTML = formatAIComment(data.comment);
        document.getElementById('commentSessionType').textContent = getSessionTypeLabel(selectedSessionType);
        document.getElementById('questionSection').style.display = 'block';
        
        // ä¼šè©±å±¥æ­´ã«è¿½åŠ 
        conversationHistory = [
            { role: 'assistant', content: data.comment }
        ];
        
    } catch (error) {
        console.error('AI comment error:', error);
        document.getElementById('aiCommentLoading').style.display = 'none';
        document.getElementById('sessionTypeSelector').style.display = 'block';
        alert('ã‚³ãƒ¡ãƒ³ãƒˆç”Ÿæˆã«å¤±æ•—ã—ã¾ã—ãŸ: ' + error.message);
    }
}

// å†ç”Ÿæˆ
function regenerateComment() {
    document.getElementById('aiCommentResult').classList.remove('visible');
    document.getElementById('questionSection').style.display = 'none';
    document.getElementById('sessionTypeSelector').style.display = 'block';
}

// è³ªå•ã™ã‚‹
async function askQuestion() {
    const input = document.getElementById('questionInput');
    const question = input.value.trim();
    
    if (!question) return;
    
    // å±¥æ­´ã‚’è¡¨ç¤º
    const historyEl = document.getElementById('chatHistory');
    historyEl.style.display = 'block';
    
    // ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®è³ªå•ã‚’è¿½åŠ 
    historyEl.innerHTML += `
        <div style="background: #f3f4f6; border-radius: 8px; padding: 10px; margin-bottom: 8px;">
            <div style="font-size: 0.8rem; color: #6b7280; margin-bottom: 4px;">ğŸ‘¤ ã‚ãªãŸ</div>
            <div>${question}</div>
        </div>
    `;
    
    input.value = '';
    
    // ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¡¨ç¤º
    historyEl.innerHTML += `
        <div id="questionLoading" style="text-align: center; padding: 10px;">
            <span style="color: #6b7280;">å›ç­”ã‚’ç”Ÿæˆä¸­...</span>
        </div>
    `;
    historyEl.scrollTop = historyEl.scrollHeight;
    
    try {
        const streamAnalysis = analyzeStreamData();
        
        conversationHistory.push({ role: 'user', content: question });
        
        const response = await fetch('/.netlify/functions/ai-coach-comment', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                activity: currentActivity,
                trainingStatus: trainingStatus,
                streamAnalysis: streamAnalysis,
                sessionType: selectedSessionType,
                userQuestion: question,
                conversationHistory: conversationHistory
            })
        });
        
        const data = await response.json();
        
        // ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚’å‰Šé™¤
        document.getElementById('questionLoading')?.remove();
        
        // å›ç­”ã‚’è¿½åŠ 
        historyEl.innerHTML += `
            <div style="background: #ede9fe; border-radius: 8px; padding: 10px; margin-bottom: 8px;">
                <div style="font-size: 0.8rem; color: #667eea; margin-bottom: 4px;">ğŸ¤– AIã‚³ãƒ¼ãƒ</div>
                <div>${formatAIComment(data.comment)}</div>
            </div>
        `;
        historyEl.scrollTop = historyEl.scrollHeight;
        
        conversationHistory.push({ role: 'assistant', content: data.comment });
        
    } catch (error) {
        document.getElementById('questionLoading')?.remove();
        historyEl.innerHTML += `
            <div style="color: #ef4444; padding: 10px;">ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ</div>
        `;
    }
}

// ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚¿ã‚¤ãƒ—ã®ãƒ©ãƒ™ãƒ«ã‚’å–å¾—
function getSessionTypeLabel(typeId) {
    const allTypes = [
        ...SESSION_TYPES.swim,
        ...SESSION_TYPES.bike,
        ...SESSION_TYPES.run,
        ...SESSION_TYPES.common
    ];
    const found = allTypes.find(t => t.id === typeId);
    return found ? found.label : typeId;
}

// AIã‚³ãƒ¡ãƒ³ãƒˆã®ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
function formatAIComment(text) {
    return text
        .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
        .replace(/\n/g, '<br>');
}

// ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
document.getElementById('generateCommentBtn').addEventListener('click', generateAIComment);
document.getElementById('questionInput')?.addEventListener('keypress', function(e) {
    if (e.key === 'Enter') askQuestion();
});

// ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«åˆæœŸåŒ–
// displayActivityDetailsé–¢æ•°ã®æœ€å¾Œã«ä»¥ä¸‹ã‚’è¿½åŠ :
// initSessionTypeSelector();
</script>
