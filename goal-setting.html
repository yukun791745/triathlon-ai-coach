<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Triathlon AI Coach - ç›®æ¨™è¨­å®š</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, sans-serif; background: linear-gradient(135deg, #dbeafe 0%, #fff 50%, #cffafe 100%); min-height: 100vh; display: flex; }
        
        .navbar { position: fixed; top: 0; left: 0; bottom: 0; width: 200px; background: linear-gradient(180deg, #667eea, #764ba2); padding: 20px 0; z-index: 1000; }
        .nav-logo { font-size: 1rem; font-weight: 700; color: white; text-align: center; padding: 0 12px 20px; border-bottom: 2px solid rgba(255,255,255,0.2); margin-bottom: 12px; }
        .nav-steps { display: flex; flex-direction: column; gap: 4px; padding: 0 10px; }
        .nav-step { display: flex; align-items: center; gap: 8px; padding: 8px 12px; border-radius: 6px; font-size: 0.8rem; font-weight: 600; text-decoration: none; color: rgba(255,255,255,0.8); transition: all 0.2s; }
        .nav-step:hover { background: rgba(255,255,255,0.15); color: white; }
        .nav-step.current { background: rgba(255,255,255,0.25); color: white; }
        
        .content { margin-left: 200px; flex: 1; padding: 16px; overflow-y: auto; }
        .container { max-width: 900px; margin: 0 auto; }
        
        .header { text-align: center; margin-bottom: 16px; }
        .title { font-size: 22px; font-weight: bold; color: #1f2937; }
        .subtitle { font-size: 11px; color: #6b7280; margin-top: 4px; }
        
        /* ãƒ¬ãƒ¼ã‚¹ã‚«ãƒ¼ãƒ‰ */
        .race-card { background: white; border-radius: 10px; padding: 16px; margin-bottom: 16px; box-shadow: 0 2px 8px rgba(0,0,0,0.08); }
        .race-card.type-a { border-left: 4px solid #f59e0b; }
        .race-card.type-b { border-left: 4px solid #3b82f6; }
        .race-card.type-c { border-left: 4px solid #a855f7; }
        
        .race-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 12px; cursor: pointer; }
        .race-header:hover { opacity: 0.8; }
        .race-name { font-size: 16px; font-weight: 700; color: #1f2937; }
        .race-badge { padding: 3px 8px; border-radius: 10px; font-size: 9px; font-weight: 600; }
        .race-badge.type-a { background: #fef3c7; color: #b45309; }
        .race-badge.type-b { background: #dbeafe; color: #1d4ed8; }
        .race-badge.type-c { background: #f3e8ff; color: #7c3aed; }
        .race-meta { display: flex; gap: 16px; flex-wrap: wrap; font-size: 11px; color: #6b7280; margin-bottom: 12px; }
        .toggle-icon { font-size: 14px; color: #9ca3af; transition: transform 0.2s; }
        .toggle-icon.open { transform: rotate(180deg); }
        
        /* ç¨®ç›®å…¥åŠ› */
        .disciplines { display: none; }
        .disciplines.open { display: block; }
        
        .discipline-row { display: grid; grid-template-columns: 70px 1fr 1fr 1fr; gap: 8px; align-items: center; padding: 8px 0; border-bottom: 1px solid #f1f5f9; }
        .discipline-row:last-child { border-bottom: none; }
        .discipline-label { font-size: 12px; font-weight: 600; color: #374151; display: flex; align-items: center; gap: 4px; }
        .discipline-label .icon { font-size: 16px; }
        
        .input-group { display: flex; flex-direction: column; gap: 2px; }
        .input-label { font-size: 9px; color: #9ca3af; }
        .input-field { padding: 6px 8px; border: 1px solid #d1d5db; border-radius: 4px; font-size: 12px; width: 100%; }
        .input-field:focus { outline: none; border-color: #667eea; }
        .input-field.calculated { background: #ecfdf5; border-color: #10b981; }
        
        /* T1/T2 è¡Œ */
        .transition-row { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; padding: 10px 0; border-top: 1px solid #e5e7eb; margin-top: 8px; }
        .trans-group { display: flex; align-items: center; gap: 8px; }
        .trans-label { font-size: 11px; font-weight: 600; color: #6b7280; min-width: 30px; }
        .trans-input { padding: 6px 8px; border: 1px solid #d1d5db; border-radius: 4px; font-size: 12px; width: 80px; }
        .trans-input:focus { outline: none; border-color: #667eea; }
        
        /* ç·åˆã‚¿ã‚¤ãƒ  */
        .total-row { display: flex; justify-content: space-between; align-items: center; padding: 12px; background: linear-gradient(135deg, #667eea, #764ba2); border-radius: 8px; margin-top: 12px; color: white; }
        .total-label { font-size: 12px; font-weight: 600; }
        .total-time { font-size: 20px; font-weight: 700; letter-spacing: 1px; }
        .total-breakdown { font-size: 10px; opacity: 0.9; margin-top: 4px; }
        
        /* ãƒœã‚¿ãƒ³ */
        .action-buttons { display: flex; gap: 10px; justify-content: center; margin-top: 20px; }
        .btn { padding: 10px 20px; border-radius: 6px; font-size: 12px; font-weight: 600; cursor: pointer; transition: all 0.2s; border: none; text-decoration: none; }
        .btn-primary { background: linear-gradient(135deg, #667eea, #764ba2); color: white; }
        .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4); }
        .btn-secondary { background: white; color: #667eea; border: 2px solid #667eea; }
        
        .no-race { text-align: center; padding: 60px 20px; background: white; border-radius: 10px; }
        .no-race-icon { font-size: 48px; margin-bottom: 16px; }
        .no-race-text { font-size: 13px; color: #6b7280; margin-bottom: 20px; }
        
        @media (max-width: 768px) {
            .navbar { width: 100%; height: 50px; bottom: auto; position: fixed; }
            .nav-steps { display: none; }
            .content { margin-left: 0; margin-top: 50px; padding: 10px; }
            .discipline-row { grid-template-columns: 60px 1fr 1fr 1fr; gap: 4px; }
        }
    </style>
</head>
<body>
    <nav class="navbar">
        <div class="nav-logo">AI Triathlon Coach</div>
        <div class="nav-steps">
            <a href="home.html" class="nav-step">ğŸ  ãƒ›ãƒ¼ãƒ </a>
            <a href="news.html" class="nav-step">ğŸ“° ãƒ‹ãƒ¥ãƒ¼ã‚¹</a>
            <a href="race-selection.html" class="nav-step">ğŸ¯ ãƒ¬ãƒ¼ã‚¹é¸æŠ</a>
            <a href="goal-setting.html" class="nav-step current">ğŸ† ç›®æ¨™è¨­å®š</a>
            <a href="training-plan.html" class="nav-step">ğŸ“‹ è¨ˆç”»</a>
            <a href="simulator.html" class="nav-step">ğŸ”¬ ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼</a>
            <a href="data.html" class="nav-step">ğŸ“Š é€²æ—</a>
        </div>
    </nav>
    
    <div class="content">
        <div class="container">
            <div class="header">
                <h1 class="title">ğŸ† ç›®æ¨™è¨­å®š</h1>
                <p class="subtitle">ãƒšãƒ¼ã‚¹ã¾ãŸã¯ã‚¿ã‚¤ãƒ ã‚’å…¥åŠ›ã™ã‚‹ã¨è‡ªå‹•è¨ˆç®—ã•ã‚Œã¾ã™</p>
            </div>
            
            <div id="races-container"></div>
            
            <div class="action-buttons">
                <a href="race-selection.html" class="btn btn-secondary">â† ãƒ¬ãƒ¼ã‚¹é¸æŠã«æˆ»ã‚‹</a>
                <button class="btn btn-primary" onclick="saveAll()">ä¿å­˜ã—ã¦è¨ˆç”»ä½œæˆã¸ â†’</button>
            </div>
        </div>
    </div>

<script>
const STORAGE_KEY = 'selected_races';
const GOAL_STORAGE_KEY = 'race_goals';

const DISTANCE_DEFAULTS = {
    'ã‚¹ãƒ—ãƒªãƒ³ãƒˆ': { swim: 750, bike: 20, run: 5 },
    'ã‚¹ã‚¿ãƒ³ãƒ€ãƒ¼ãƒ‰': { swim: 1500, bike: 40, run: 10 },
    'ãƒŸãƒ‰ãƒ«': { swim: 1900, bike: 90, run: 21.1 },
    'ãƒ­ãƒ³ã‚°': { swim: 3800, bike: 180, run: 42.2 },
    'ã‚ªãƒ•ãƒ­ãƒ¼ãƒ‰': { swim: 1500, bike: 30, run: 10 },
    'ãƒ‡ãƒ¥ã‚¢ã‚¹ãƒ­ãƒ³': { swim: 0, bike: 40, run: 10 },
    'ã‚¢ã‚¯ã‚¢ã‚¹ãƒ­ãƒ³': { swim: 1000, bike: 0, run: 5 },
    'ã‚¦ã‚£ãƒ³ã‚¿ãƒ¼': { swim: 0, bike: 0, run: 8 },
    'ã‚¹ãƒ¼ãƒ‘ãƒ¼ã‚¹ãƒ—ãƒªãƒ³ãƒˆ': { swim: 400, bike: 10, run: 2.5 }
};

let races = [];
let goals = {};
let openCards = new Set();

function init() {
    loadRaces();
    loadGoals();
    
    if (races.length === 0) {
        showNoRace();
        return;
    }
    
    // æœ€åˆã®ãƒ¬ãƒ¼ã‚¹ã¯é–‹ã„ãŸçŠ¶æ…‹
    if (races.length > 0) openCards.add(races[0].id);
    
    renderAllRaces();
}

function loadRaces() {
    try {
        const saved = localStorage.getItem(STORAGE_KEY);
        if (!saved) return;
        
        const data = JSON.parse(saved);
        const details = data.details || {};
        
        ['a', 'b', 'c'].forEach(type => {
            const ids = data[type] || [];
            ids.forEach(id => {
                if (details[id]) {
                    races.push({ ...details[id], selType: type });
                }
            });
        });
        
        races.sort((a, b) => a.date.localeCompare(b.date));
    } catch (e) {
        console.error('Load error:', e);
    }
}

function loadGoals() {
    try {
        const saved = localStorage.getItem(GOAL_STORAGE_KEY);
        if (saved) goals = JSON.parse(saved);
    } catch (e) {
        goals = {};
    }
}

function saveGoals() {
    localStorage.setItem(GOAL_STORAGE_KEY, JSON.stringify(goals));
    updateRaceSelectionTargetTimes();
}

function updateRaceSelectionTargetTimes() {
    try {
        const saved = localStorage.getItem(STORAGE_KEY);
        if (!saved) return;
        
        const data = JSON.parse(saved);
        if (!data.targetTimes) data.targetTimes = {};
        
        races.forEach(race => {
            const g = goals[race.id];
            if (g) {
                const total = (g.swimTime || 0) + (g.t1 || 0) + (g.bikeTime || 0) + (g.t2 || 0) + (g.runTime || 0);
                if (total > 0) {
                    data.targetTimes[race.id] = formatTime(total);
                }
            }
        });
        
        localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
    } catch (e) {
        console.error('Update error:', e);
    }
}

function showNoRace() {
    document.getElementById('races-container').innerHTML = `
        <div class="no-race">
            <div class="no-race-icon">ğŸ</div>
            <div class="no-race-text">ç›®æ¨™è¨­å®šã™ã‚‹ãƒ¬ãƒ¼ã‚¹ãŒã‚ã‚Šã¾ã›ã‚“<br>ã¾ãšãƒ¬ãƒ¼ã‚¹é¸æŠãƒšãƒ¼ã‚¸ã§ãƒ¬ãƒ¼ã‚¹ã‚’é¸ã‚“ã§ãã ã•ã„</div>
            <a href="race-selection.html" class="btn btn-primary">ãƒ¬ãƒ¼ã‚¹é¸æŠã¸ â†’</a>
        </div>
    `;
}

function renderAllRaces() {
    const container = document.getElementById('races-container');
    container.innerHTML = races.map(race => renderRaceCard(race)).join('');
}

function renderRaceCard(race) {
    const typeLabels = { a: 'ğŸ† Aãƒ¬ãƒ¼ã‚¹', b: 'ğŸ¯ Bãƒ¬ãƒ¼ã‚¹', c: 'ğŸ¤” æ¤œè¨ä¸­' };
    const dt = new Date(race.date);
    const dateStr = `${dt.getFullYear()}/${dt.getMonth()+1}/${dt.getDate()}`;
    const dow = ['æ—¥','æœˆ','ç«','æ°´','æœ¨','é‡‘','åœŸ'][dt.getDay()];
    const isOpen = openCards.has(race.id);
    
    const defaults = DISTANCE_DEFAULTS[race.dist] || DISTANCE_DEFAULTS['ã‚¹ã‚¿ãƒ³ãƒ€ãƒ¼ãƒ‰'];
    const g = goals[race.id] || {
        swimDist: defaults.swim,
        bikeDist: defaults.bike,
        runDist: defaults.run,
        t1: 180,
        t2: 120
    };
    
    const totalTime = (g.swimTime || 0) + (g.t1 || 0) + (g.bikeTime || 0) + (g.t2 || 0) + (g.runTime || 0);
    
    return `
    <div class="race-card type-${race.selType}" data-id="${race.id}">
        <div class="race-header" onclick="toggleCard('${race.id}')">
            <div>
                <div class="race-name">${race.name}</div>
                <div class="race-meta">
                    <span>ğŸ“… ${dateStr}(${dow})</span>
                    <span>ğŸ“ ${race.loc || ''}</span>
                    <span>ğŸŠ ${race.dist}</span>
                </div>
            </div>
            <div style="display:flex;align-items:center;gap:8px;">
                <span class="race-badge type-${race.selType}">${typeLabels[race.selType]}</span>
                <span class="toggle-icon ${isOpen ? 'open' : ''}">â–¼</span>
            </div>
        </div>
        
        <div class="disciplines ${isOpen ? 'open' : ''}" id="disc-${race.id}">
            <!-- ã‚¹ã‚¤ãƒ  -->
            <div class="discipline-row">
                <div class="discipline-label"><span class="icon">ğŸŠ</span>ã‚¹ã‚¤ãƒ </div>
                <div class="input-group">
                    <span class="input-label">è·é›¢ (m)</span>
                    <input type="number" class="input-field" id="${race.id}-swim-dist" value="${g.swimDist || defaults.swim}" onchange="calc('${race.id}','swim','dist')">
                </div>
                <div class="input-group">
                    <span class="input-label">ãƒšãƒ¼ã‚¹ (åˆ†:ç§’/100m)</span>
                    <input type="text" class="input-field" id="${race.id}-swim-pace" value="${g.swimPace ? formatPace(g.swimPace) : ''}" placeholder="2:00" onchange="calc('${race.id}','swim','pace')">
                </div>
                <div class="input-group">
                    <span class="input-label">ã‚¿ã‚¤ãƒ </span>
                    <input type="text" class="input-field" id="${race.id}-swim-time" value="${g.swimTime ? formatTime(g.swimTime) : ''}" placeholder="0:30:00" onchange="calc('${race.id}','swim','time')">
                </div>
            </div>
            
            <!-- ãƒã‚¤ã‚¯ -->
            <div class="discipline-row">
                <div class="discipline-label"><span class="icon">ğŸš´</span>ãƒã‚¤ã‚¯</div>
                <div class="input-group">
                    <span class="input-label">è·é›¢ (km)</span>
                    <input type="number" class="input-field" id="${race.id}-bike-dist" value="${g.bikeDist || defaults.bike}" step="0.1" onchange="calc('${race.id}','bike','dist')">
                </div>
                <div class="input-group">
                    <span class="input-label">é€Ÿåº¦ (km/h)</span>
                    <input type="number" class="input-field" id="${race.id}-bike-pace" value="${g.bikePace ? g.bikePace.toFixed(1) : ''}" placeholder="30.0" step="0.1" onchange="calc('${race.id}','bike','pace')">
                </div>
                <div class="input-group">
                    <span class="input-label">ã‚¿ã‚¤ãƒ </span>
                    <input type="text" class="input-field" id="${race.id}-bike-time" value="${g.bikeTime ? formatTime(g.bikeTime) : ''}" placeholder="1:20:00" onchange="calc('${race.id}','bike','time')">
                </div>
            </div>
            
            <!-- ãƒ©ãƒ³ -->
            <div class="discipline-row">
                <div class="discipline-label"><span class="icon">ğŸƒ</span>ãƒ©ãƒ³</div>
                <div class="input-group">
                    <span class="input-label">è·é›¢ (km)</span>
                    <input type="number" class="input-field" id="${race.id}-run-dist" value="${g.runDist || defaults.run}" step="0.1" onchange="calc('${race.id}','run','dist')">
                </div>
                <div class="input-group">
                    <span class="input-label">ãƒšãƒ¼ã‚¹ (åˆ†:ç§’/km)</span>
                    <input type="text" class="input-field" id="${race.id}-run-pace" value="${g.runPace ? formatPace(g.runPace) : ''}" placeholder="5:30" onchange="calc('${race.id}','run','pace')">
                </div>
                <div class="input-group">
                    <span class="input-label">ã‚¿ã‚¤ãƒ </span>
                    <input type="text" class="input-field" id="${race.id}-run-time" value="${g.runTime ? formatTime(g.runTime) : ''}" placeholder="0:55:00" onchange="calc('${race.id}','run','time')">
                </div>
            </div>
            
            <!-- T1 / T2 -->
            <div class="transition-row">
                <div class="trans-group">
                    <span class="trans-label">ğŸ”„ T1</span>
                    <input type="text" class="trans-input" id="${race.id}-t1" value="${formatPace(g.t1 || 180)}" placeholder="3:00" onchange="calcTotal('${race.id}')">
                    <span style="font-size:9px;color:#9ca3af;">åˆ†:ç§’</span>
                </div>
                <div class="trans-group">
                    <span class="trans-label">ğŸ”„ T2</span>
                    <input type="text" class="trans-input" id="${race.id}-t2" value="${formatPace(g.t2 || 120)}" placeholder="2:00" onchange="calcTotal('${race.id}')">
                    <span style="font-size:9px;color:#9ca3af;">åˆ†:ç§’</span>
                </div>
            </div>
            
            <!-- ç·åˆã‚¿ã‚¤ãƒ  -->
            <div class="total-row">
                <div>
                    <div class="total-label">ç›®æ¨™ãƒ•ã‚£ãƒ‹ãƒƒã‚·ãƒ¥ã‚¿ã‚¤ãƒ </div>
                    <div class="total-breakdown" id="${race.id}-breakdown">
                        ğŸŠ -- + T1 -- + ğŸš´ -- + T2 -- + ğŸƒ --
                    </div>
                </div>
                <div class="total-time" id="${race.id}-total">${totalTime > 0 ? formatTime(totalTime) : '--:--:--'}</div>
            </div>
        </div>
    </div>
    `;
}

function toggleCard(id) {
    if (openCards.has(id)) {
        openCards.delete(id);
    } else {
        openCards.add(id);
    }
    
    const disc = document.getElementById('disc-' + id);
    const icon = document.querySelector(`[data-id="${id}"] .toggle-icon`);
    
    if (disc) disc.classList.toggle('open', openCards.has(id));
    if (icon) icon.classList.toggle('open', openCards.has(id));
}

// === ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆé–¢æ•° ===
function formatTime(seconds) {
    if (!seconds || seconds <= 0) return '';
    const h = Math.floor(seconds / 3600);
    const m = Math.floor((seconds % 3600) / 60);
    const s = Math.round(seconds % 60);
    if (h > 0) return `${h}:${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`;
    return `${m}:${String(s).padStart(2,'0')}`;
}

function formatPace(seconds) {
    if (!seconds || seconds <= 0) return '';
    const m = Math.floor(seconds / 60);
    const s = Math.round(seconds % 60);
    return `${m}:${String(s).padStart(2,'0')}`;
}

function parseTime(str) {
    if (!str) return 0;
    const parts = str.split(':').map(Number);
    if (parts.length === 3) return parts[0] * 3600 + parts[1] * 60 + parts[2];
    if (parts.length === 2) return parts[0] * 60 + parts[1];
    return 0;
}

// === è¨ˆç®—é–¢æ•° ===
function calc(raceId, sport, changed) {
    const distEl = document.getElementById(`${raceId}-${sport}-dist`);
    const paceEl = document.getElementById(`${raceId}-${sport}-pace`);
    const timeEl = document.getElementById(`${raceId}-${sport}-time`);
    
    const dist = parseFloat(distEl.value) || 0;
    
    if (sport === 'swim') {
        // ã‚¹ã‚¤ãƒ : ãƒšãƒ¼ã‚¹ = ç§’/100m
        if (changed === 'pace' && paceEl.value) {
            const pace = parseTime(paceEl.value);
            const total = (dist / 100) * pace;
            timeEl.value = formatTime(total);
            timeEl.classList.add('calculated');
            paceEl.classList.remove('calculated');
        } else if (changed === 'time' && timeEl.value) {
            const total = parseTime(timeEl.value);
            const pace = total / (dist / 100);
            paceEl.value = formatPace(pace);
            paceEl.classList.add('calculated');
            timeEl.classList.remove('calculated');
        } else if (changed === 'dist' && paceEl.value) {
            const pace = parseTime(paceEl.value);
            const total = (dist / 100) * pace;
            timeEl.value = formatTime(total);
        }
    } else if (sport === 'bike') {
        // ãƒã‚¤ã‚¯: é€Ÿåº¦ = km/h
        if (changed === 'pace' && paceEl.value) {
            const speed = parseFloat(paceEl.value);
            if (speed > 0) {
                const total = (dist / speed) * 3600;
                timeEl.value = formatTime(total);
                timeEl.classList.add('calculated');
                paceEl.classList.remove('calculated');
            }
        } else if (changed === 'time' && timeEl.value) {
            const total = parseTime(timeEl.value);
            if (total > 0) {
                const speed = dist / (total / 3600);
                paceEl.value = speed.toFixed(1);
                paceEl.classList.add('calculated');
                timeEl.classList.remove('calculated');
            }
        } else if (changed === 'dist' && paceEl.value) {
            const speed = parseFloat(paceEl.value);
            if (speed > 0) {
                const total = (dist / speed) * 3600;
                timeEl.value = formatTime(total);
            }
        }
    } else if (sport === 'run') {
        // ãƒ©ãƒ³: ãƒšãƒ¼ã‚¹ = ç§’/km
        if (changed === 'pace' && paceEl.value) {
            const pace = parseTime(paceEl.value);
            const total = dist * pace;
            timeEl.value = formatTime(total);
            timeEl.classList.add('calculated');
            paceEl.classList.remove('calculated');
        } else if (changed === 'time' && timeEl.value) {
            const total = parseTime(timeEl.value);
            if (dist > 0) {
                const pace = total / dist;
                paceEl.value = formatPace(pace);
                paceEl.classList.add('calculated');
                timeEl.classList.remove('calculated');
            }
        } else if (changed === 'dist' && paceEl.value) {
            const pace = parseTime(paceEl.value);
            const total = dist * pace;
            timeEl.value = formatTime(total);
        }
    }
    
    calcTotal(raceId);
}

function calcTotal(raceId) {
    const swimTime = parseTime(document.getElementById(`${raceId}-swim-time`)?.value);
    const bikeTime = parseTime(document.getElementById(`${raceId}-bike-time`)?.value);
    const runTime = parseTime(document.getElementById(`${raceId}-run-time`)?.value);
    const t1 = parseTime(document.getElementById(`${raceId}-t1`)?.value);
    const t2 = parseTime(document.getElementById(`${raceId}-t2`)?.value);
    
    const total = swimTime + t1 + bikeTime + t2 + runTime;
    
    document.getElementById(`${raceId}-total`).textContent = total > 0 ? formatTime(total) : '--:--:--';
    document.getElementById(`${raceId}-breakdown`).textContent = 
        `ğŸŠ ${swimTime > 0 ? formatTime(swimTime) : '--'} + T1 ${t1 > 0 ? formatPace(t1) : '--'} + ğŸš´ ${bikeTime > 0 ? formatTime(bikeTime) : '--'} + T2 ${t2 > 0 ? formatPace(t2) : '--'} + ğŸƒ ${runTime > 0 ? formatTime(runTime) : '--'}`;
    
    // ä¿å­˜
    saveGoal(raceId);
}

function saveGoal(raceId) {
    goals[raceId] = {
        swimDist: parseFloat(document.getElementById(`${raceId}-swim-dist`)?.value) || 0,
        swimPace: parseTime(document.getElementById(`${raceId}-swim-pace`)?.value),
        swimTime: parseTime(document.getElementById(`${raceId}-swim-time`)?.value),
        bikeDist: parseFloat(document.getElementById(`${raceId}-bike-dist`)?.value) || 0,
        bikePace: parseFloat(document.getElementById(`${raceId}-bike-pace`)?.value) || 0,
        bikeTime: parseTime(document.getElementById(`${raceId}-bike-time`)?.value),
        runDist: parseFloat(document.getElementById(`${raceId}-run-dist`)?.value) || 0,
        runPace: parseTime(document.getElementById(`${raceId}-run-pace`)?.value),
        runTime: parseTime(document.getElementById(`${raceId}-run-time`)?.value),
        t1: parseTime(document.getElementById(`${raceId}-t1`)?.value),
        t2: parseTime(document.getElementById(`${raceId}-t2`)?.value)
    };
    saveGoals();
}

function saveAll() {
    races.forEach(race => saveGoal(race.id));
    alert('ç›®æ¨™ã‚’ä¿å­˜ã—ã¾ã—ãŸï¼');
    location.href = 'training-plan.html';
}

document.addEventListener('DOMContentLoaded', init);
</script>
</body>
</html>
